# JNIæ¥å£è®¾ç½®ä¸ç³»ç»Ÿå®ŒæˆéªŒè¯æ·±åº¦åˆ†æ

## ğŸ“‹ **æ¦‚è¿°**

æœ¬æ–‡æ¡£æ·±å…¥åˆ†æJVMåˆ›å»ºæˆåŠŸåçš„JNIæ¥å£è®¾ç½®ã€ç³»ç»Ÿå®ŒæˆéªŒè¯ã€ä»¥åŠæœ€ç»ˆçš„è¾“å‡ºå¤„ç†æœºåˆ¶ã€‚è¿™æ˜¯JVMå¯åŠ¨æµç¨‹çš„æœ€åç¯èŠ‚ï¼Œç¡®ä¿æ‰€æœ‰æ¥å£æ­£ç¡®è®¾ç½®ï¼Œç³»ç»ŸçŠ¶æ€å®Œå…¨å°±ç»ªï¼Œä¸ºç”¨æˆ·åº”ç”¨ç¨‹åºçš„æ‰§è¡Œåšå¥½å‡†å¤‡ã€‚

### **åˆ†æç¯å¢ƒ**
- **æ“ä½œç³»ç»Ÿ**: Linux x86_64
- **å †å¤§å°**: 8GB (ä¸ä½¿ç”¨å¤§é¡µ)
- **JVMç‰ˆæœ¬**: OpenJDK 11
- **æ¥å£æ ‡å‡†**: JNI 1.8è§„èŒƒ

---

## ğŸ”Œ **JNIæ¥å£æ¶æ„ä¸è®¾ç½®**

### **1. JNIæ¥å£å±‚æ¬¡ç»“æ„**

```cpp
// JNIæ¥å£çš„æ ¸å¿ƒç»“æ„
struct JavaVM_ {
    const struct JNIInvokeInterface_ *functions;
    // å…¶ä»–VMç‰¹å®šæ•°æ®...
};

struct JNIEnv_ {
    const struct JNINativeInterface_ *functions;
    // å…¶ä»–ç¯å¢ƒç‰¹å®šæ•°æ®...
};
```

#### **1.1 JNIæ¥å£è®¾ç½®è¿‡ç¨‹**

```cpp
if (result == JNI_OK) {
    JavaThread *thread = JavaThread::current();
    assert(!thread->has_pending_exception(), "should have returned not OK");
    
    /* thread is thread_in_vm here */
    *vm = (JavaVM *)(&main_vm);                    // è®¾ç½®JavaVMæŒ‡é’ˆ
    *(JNIEnv**)penv = thread->jni_environment();  // è®¾ç½®JNIEnvæŒ‡é’ˆ
    
    // åç»­å¤„ç†...
}
```

#### **1.2 JNIæ¥å£ç»“æ„è¯¦è§£**

```
JNIæ¥å£å±‚æ¬¡æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨ç¨‹åºä»£ç                               â”‚
â”‚                         â†‘                                   â”‚
â”‚                    JNIå‡½æ•°è°ƒç”¨                              â”‚
â”‚                         â†‘                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚ â”‚    JavaVM*      â”‚    â”‚    JNIEnv*      â”‚                 â”‚
â”‚ â”‚  (VMæ¥å£)       â”‚    â”‚  (ç¯å¢ƒæ¥å£)     â”‚                 â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â†‘                       â†‘                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚ â”‚JNIInvokeInterfaceâ”‚    â”‚JNINativeInterfaceâ”‚                â”‚
â”‚ â”‚   å‡½æ•°è¡¨         â”‚    â”‚   å‡½æ•°è¡¨         â”‚                 â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â†‘                       â†‘                          â”‚
â”‚                    JVMå®ç°                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. JavaVMæ¥å£å®ç°**

#### **2.1 å…¨å±€JavaVMå®ä¾‹**

```cpp
// å…¨å±€VMå®ä¾‹å®šä¹‰
struct JavaVM_ main_vm = {&jni_InvokeInterface};

// JNIè°ƒç”¨æ¥å£è¡¨
const struct JNIInvokeInterface_ jni_InvokeInterface = {
    NULL,                           // reserved0
    NULL,                           // reserved1  
    NULL,                           // reserved2
    jni_DestroyJavaVM,             // DestroyJavaVM
    jni_AttachCurrentThread,       // AttachCurrentThread
    jni_DetachCurrentThread,       // DetachCurrentThread
    jni_GetEnv,                    // GetEnv
    jni_AttachCurrentThreadAsDaemon // AttachCurrentThreadAsDaemon
};
```

#### **2.2 JavaVMå‡½æ•°è¡¨è¯¦è§£**

```
JavaVMæ¥å£å‡½æ•°åŠŸèƒ½ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‡½æ•°åç§°                â”‚ åŠŸèƒ½æè¿°                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DestroyJavaVM           â”‚ é”€æ¯Javaè™šæ‹Ÿæœº                   â”‚
â”‚ AttachCurrentThread     â”‚ å°†å½“å‰çº¿ç¨‹é™„åŠ åˆ°VM               â”‚
â”‚ DetachCurrentThread     â”‚ ä»VMåˆ†ç¦»å½“å‰çº¿ç¨‹                 â”‚
â”‚ GetEnv                  â”‚ è·å–JNIç¯å¢ƒæŒ‡é’ˆ                  â”‚
â”‚ AttachCurrentThreadAsDaemon â”‚ ä½œä¸ºå®ˆæŠ¤çº¿ç¨‹é™„åŠ åˆ°VM         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **2.3 JavaVMç”Ÿå‘½å‘¨æœŸç®¡ç†**

```cpp
jint JNICALL jni_DestroyJavaVM(JavaVM *vm) {
    jint result = JNI_ERR;
    
    // æ£€æŸ¥VMçŠ¶æ€
    if (vm_created == 0) {
        return JNI_ERR;
    }
    
    // æ‰§è¡ŒVMé”€æ¯
    JavaThread* thread = JavaThread::current();
    ThreadStateTransition::transition_from_native(thread, _thread_in_vm);
    
    if (Threads::destroy_vm()) {
        vm_created = 0;
        result = JNI_OK;
    } else {
        result = JNI_ERR;
    }
    
    return result;
}
```

### **3. JNIEnvæ¥å£å®ç°**

#### **3.1 çº¿ç¨‹æœ¬åœ°JNIç¯å¢ƒ**

```cpp
JNIEnv* JavaThread::jni_environment() {
    return &_jni_environment;
}

// JNIç¯å¢ƒç»“æ„
class JNIEnv_ {
private:
    const struct JNINativeInterface_ *functions;
    JavaThread* _thread;
    
public:
    JNIEnv_(JavaThread* thread) : _thread(thread) {
        functions = jni_functions();
    }
};
```

#### **3.2 JNIå‡½æ•°è¡¨ç”Ÿæˆ**

```cpp
struct JNINativeInterface_* jni_functions() {
#if INCLUDE_JNI_CHECK
    if (CheckJNICalls) return jni_functions_check();
#endif // INCLUDE_JNI_CHECK
    return &jni_NativeInterface;
}

// æ ¸å¿ƒJNIå‡½æ•°è¡¨
struct JNINativeInterface_ jni_NativeInterface = {
    NULL,                    // reserved0
    NULL,                    // reserved1
    NULL,                    // reserved2
    NULL,                    // reserved3
    
    jni_GetVersion,          // GetVersion
    
    jni_DefineClass,         // DefineClass
    jni_FindClass,           // FindClass
    
    // ... 200+ JNIå‡½æ•° ...
    
    jni_GetDirectBufferAddress,    // GetDirectBufferAddress
    jni_GetDirectBufferCapacity,   // GetDirectBufferCapacity
};
```

#### **3.3 JNIå‡½æ•°åˆ†ç±»**

```
JNIå‡½æ•°åˆ†ç±»ç»Ÿè®¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠŸèƒ½ç±»åˆ«                â”‚ å‡½æ•°æ•°é‡    â”‚ ä¸»è¦ç”¨é€”             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç‰ˆæœ¬å’Œç±»æ“ä½œ            â”‚ 8           â”‚ åŸºç¡€VMäº¤äº’           â”‚
â”‚ å¼‚å¸¸å¤„ç†                â”‚ 9           â”‚ å¼‚å¸¸ç®¡ç†             â”‚
â”‚ å…¨å±€å’Œå±€éƒ¨å¼•ç”¨          â”‚ 12          â”‚ å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç®¡ç†     â”‚
â”‚ å¯¹è±¡æ“ä½œ                â”‚ 15          â”‚ å¯¹è±¡åˆ›å»ºå’Œè®¿é—®       â”‚
â”‚ å®ä¾‹å­—æ®µè®¿é—®            â”‚ 18          â”‚ å­—æ®µè¯»å†™             â”‚
â”‚ é™æ€å­—æ®µè®¿é—®            â”‚ 18          â”‚ é™æ€å­—æ®µè¯»å†™         â”‚
â”‚ æ–¹æ³•è°ƒç”¨                â”‚ 36          â”‚ æ–¹æ³•è°ƒç”¨             â”‚
â”‚ å­—ç¬¦ä¸²æ“ä½œ              â”‚ 12          â”‚ å­—ç¬¦ä¸²å¤„ç†           â”‚
â”‚ æ•°ç»„æ“ä½œ                â”‚ 45          â”‚ æ•°ç»„åˆ›å»ºå’Œè®¿é—®       â”‚
â”‚ ç›‘è§†å™¨æ“ä½œ              â”‚ 2           â”‚ åŒæ­¥æ§åˆ¶             â”‚
â”‚ NIOæ”¯æŒ                 â”‚ 4           â”‚ ç›´æ¥å†…å­˜è®¿é—®         â”‚
â”‚ åå°„æ”¯æŒ                â”‚ 8           â”‚ åå°„API              â”‚
â”‚ æ€»è®¡                    â”‚ 187         â”‚ å®Œæ•´JNIè§„èŒƒ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” **JNIæ£€æŸ¥æœºåˆ¶**

### **1. JNIè°ƒç”¨æ£€æŸ¥**

```cpp
#if INCLUDE_JNI_CHECK
if (CheckJNICalls) return jni_functions_check();
#endif
```

#### **1.1 JNIæ£€æŸ¥åŠŸèƒ½**

JNIæ£€æŸ¥æä¾›çš„éªŒè¯ï¼š
- **å‚æ•°æœ‰æ•ˆæ€§æ£€æŸ¥**ï¼šç©ºæŒ‡é’ˆã€æ— æ•ˆå¼•ç”¨ç­‰
- **çº¿ç¨‹çŠ¶æ€éªŒè¯**ï¼šç¡®ä¿åœ¨æ­£ç¡®çš„çº¿ç¨‹çŠ¶æ€ä¸‹è°ƒç”¨
- **å¼‚å¸¸çŠ¶æ€æ£€æŸ¥**ï¼šæ£€æŸ¥å¾…å¤„ç†å¼‚å¸¸
- **å¼•ç”¨ç±»å‹éªŒè¯**ï¼šå…¨å±€å¼•ç”¨vså±€éƒ¨å¼•ç”¨
- **æ•°ç»„è¾¹ç•Œæ£€æŸ¥**ï¼šé˜²æ­¢è¶Šç•Œè®¿é—®

#### **1.2 JNIæ£€æŸ¥å®ç°ç¤ºä¾‹**

```cpp
// JNIæ£€æŸ¥ç‰ˆæœ¬çš„FindClasså®ç°
jclass JNICALL jni_FindClass_check(JNIEnv *env, const char *name) {
    // 1. å‚æ•°æ£€æŸ¥
    if (name == NULL) {
        ReportJNIFatalError(env, "FindClass: class name is NULL");
        return NULL;
    }
    
    // 2. çº¿ç¨‹çŠ¶æ€æ£€æŸ¥
    JavaThread* thread = JavaThread::current();
    if (thread->thread_state() != _thread_in_native) {
        ReportJNIFatalError(env, "FindClass: not in native thread state");
        return NULL;
    }
    
    // 3. å¼‚å¸¸çŠ¶æ€æ£€æŸ¥
    if (thread->has_pending_exception()) {
        ReportJNIFatalError(env, "FindClass: pending exception exists");
        return NULL;
    }
    
    // 4. è°ƒç”¨å®é™…å®ç°
    return jni_FindClass(env, name);
}
```

### **2. JNIé”™è¯¯æŠ¥å‘Šæœºåˆ¶**

#### **2.1 é”™è¯¯æŠ¥å‘Šå‡½æ•°**

```cpp
void ReportJNIFatalError(JNIEnv* env, const char* msg) {
    tty->print_cr("FATAL ERROR in native method: %s", msg);
    
    // æ‰“å°è°ƒç”¨æ ˆ
    JavaThread* thread = JavaThread::current();
    thread->print_stack_on(tty);
    
    // å¼ºåˆ¶é€€å‡º
    vm_abort(false);
}
```

#### **2.2 JNIæ£€æŸ¥æ€§èƒ½å½±å“**

```
JNIæ£€æŸ¥æ€§èƒ½å¼€é”€ (8GBå †ç¯å¢ƒ)ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥ç±»å‹                â”‚ å¼€é”€        â”‚ é¢‘ç‡        â”‚ æ€»å½±å“ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‚æ•°æœ‰æ•ˆæ€§æ£€æŸ¥          â”‚ 2-5ns       â”‚ æ¯æ¬¡è°ƒç”¨    â”‚ ä½     â”‚
â”‚ çº¿ç¨‹çŠ¶æ€æ£€æŸ¥            â”‚ 5-10ns      â”‚ æ¯æ¬¡è°ƒç”¨    â”‚ ä¸­     â”‚
â”‚ å¼‚å¸¸çŠ¶æ€æ£€æŸ¥            â”‚ 3-8ns       â”‚ æ¯æ¬¡è°ƒç”¨    â”‚ ä½     â”‚
â”‚ å¼•ç”¨ç±»å‹éªŒè¯            â”‚ 10-20ns     â”‚ å¯¹è±¡æ“ä½œ    â”‚ ä¸­     â”‚
â”‚ æ•°ç»„è¾¹ç•Œæ£€æŸ¥            â”‚ 5-15ns      â”‚ æ•°ç»„è®¿é—®    â”‚ ä¸­     â”‚
â”‚ æ€»ä½“æ€§èƒ½å½±å“            â”‚ 20-50%      â”‚ JNIå¯†é›†åº”ç”¨ â”‚ æ˜¾è‘—   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… **ç³»ç»Ÿå®ŒæˆéªŒè¯**

### **1. æ–­è¨€æ£€æŸ¥æœºåˆ¶**

```cpp
JavaThread *thread = JavaThread::current();
assert(!thread->has_pending_exception(), "should have returned not OK");
```

#### **1.1 å…³é”®æ–­è¨€éªŒè¯**

```cpp
// ç³»ç»Ÿå®Œæˆæ—¶çš„å…³é”®æ–­è¨€
assert(Universe::is_fully_initialized(), "Universe not initialized");
assert(SystemDictionary::is_initialized(), "SystemDictionary not ready");
assert(thread->thread_state() == _thread_in_vm, "Wrong thread state");
assert(vm_created == 1, "VM creation flag not set");
assert(!thread->has_pending_exception(), "Unexpected pending exception");
```

#### **1.2 æ–­è¨€å¤±è´¥å¤„ç†**

```cpp
#ifdef ASSERT
void report_assertion_failure(const char* file, int line, const char* message) {
    tty->print_cr("# Internal Error (%s:%d)", file, line);
    tty->print_cr("# assert(%s)", message);
    
    // æ‰“å°VMçŠ¶æ€
    print_vm_state();
    
    // ç”Ÿæˆæ ¸å¿ƒè½¬å‚¨
    os::abort();
}
#endif
```

### **2. ç³»ç»ŸçŠ¶æ€éªŒè¯**

#### **2.1 Universeåˆå§‹åŒ–éªŒè¯**

```cpp
bool Universe::is_fully_initialized() {
    return _fully_initialized &&
           _bootstrapping == false &&
           _module_initialized == true;
}
```

#### **2.2 çº¿ç¨‹çŠ¶æ€éªŒè¯**

```cpp
// çº¿ç¨‹çŠ¶æ€ä¸€è‡´æ€§æ£€æŸ¥
bool verify_thread_state(JavaThread* thread) {
    // æ£€æŸ¥çº¿ç¨‹çŠ¶æ€
    if (thread->thread_state() != _thread_in_vm) {
        return false;
    }
    
    // æ£€æŸ¥JNIç¯å¢ƒ
    if (thread->jni_environment() == NULL) {
        return false;
    }
    
    // æ£€æŸ¥å¼‚å¸¸çŠ¶æ€
    if (thread->has_pending_exception()) {
        return false;
    }
    
    // æ£€æŸ¥å¥æŸ„å—
    if (thread->active_handles() == NULL) {
        return false;
    }
    
    return true;
}
```

### **3. å†…å­˜çŠ¶æ€éªŒè¯**

#### **3.1 å †çŠ¶æ€æ£€æŸ¥**

```cpp
bool verify_heap_state() {
    CollectedHeap* heap = Universe::heap();
    
    // æ£€æŸ¥å †æ˜¯å¦åˆå§‹åŒ–
    if (heap == NULL) {
        return false;
    }
    
    // æ£€æŸ¥å †åŒºåŸŸ
    if (!heap->is_in_reserved(heap->reserved_region().start())) {
        return false;
    }
    
    // æ£€æŸ¥GCçŠ¶æ€
    if (heap->is_gc_active()) {
        return false;  // ä¸åº”è¯¥åœ¨GCä¸­
    }
    
    return true;
}
```

#### **3.2 MetaspaceçŠ¶æ€æ£€æŸ¥**

```cpp
bool verify_metaspace_state() {
    // æ£€æŸ¥Metaspaceåˆå§‹åŒ–
    if (!Metaspace::initialized()) {
        return false;
    }
    
    // æ£€æŸ¥ç±»åŠ è½½å™¨æ•°æ®
    if (ClassLoaderDataGraph::_head == NULL) {
        return false;
    }
    
    // æ£€æŸ¥ç³»ç»Ÿå­—å…¸
    if (!SystemDictionary::is_initialized()) {
        return false;
    }
    
    return true;
}
```

---

## ğŸ“¤ **è¾“å‡ºæµå¤„ç†**

### **1. æ ‡å‡†è¾“å‡ºåˆ·æ–°**

```cpp
// é€€å‡ºå‰åˆ·æ–°stdoutå’Œstderr
fflush(stdout);
fflush(stderr);
```

#### **1.1 è¾“å‡ºç¼“å†²æœºåˆ¶**

```
æ ‡å‡†è¾“å‡ºç¼“å†²ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å‡ºæµç±»å‹              â”‚ ç¼“å†²æ¨¡å¼    â”‚ åˆ·æ–°æ—¶æœº             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ stdout (ç»ˆç«¯)           â”‚ è¡Œç¼“å†²      â”‚ æ¢è¡Œç¬¦æˆ–ç¼“å†²åŒºæ»¡     â”‚
â”‚ stdout (æ–‡ä»¶)           â”‚ å…¨ç¼“å†²      â”‚ ç¼“å†²åŒºæ»¡æˆ–æ˜¾å¼åˆ·æ–°   â”‚
â”‚ stderr                  â”‚ æ— ç¼“å†²      â”‚ ç«‹å³è¾“å‡º             â”‚
â”‚ æ—¥å¿—æ–‡ä»¶                â”‚ å…¨ç¼“å†²      â”‚ å®šæœŸæˆ–æ˜¾å¼åˆ·æ–°       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **1.2 è¾“å‡ºåˆ·æ–°çš„é‡è¦æ€§**

å¼ºåˆ¶åˆ·æ–°è¾“å‡ºçš„åŸå› ï¼š
- **æ•°æ®å®Œæ•´æ€§**ï¼šç¡®ä¿æ‰€æœ‰è¾“å‡ºéƒ½è¢«å†™å…¥
- **è°ƒè¯•æ”¯æŒ**ï¼šä¿è¯é”™è¯¯ä¿¡æ¯å¯è§
- **è¿›ç¨‹æ¸…ç†**ï¼šé¿å…ç¼“å†²åŒºæ•°æ®ä¸¢å¤±
- **ç”¨æˆ·ä½“éªŒ**ï¼šæä¾›åŠæ—¶çš„åé¦ˆä¿¡æ¯

### **2. æ—¥å¿—ç³»ç»Ÿé›†æˆ**

#### **2.1 ç»Ÿä¸€æ—¥å¿—æ¡†æ¶**

```cpp
// JVMç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ
class LogConfiguration {
public:
    static void post_initialize() {
        // é…ç½®æ—¥å¿—è¾“å‡º
        configure_stdout();
        
        // è®¾ç½®æ—¥å¿—çº§åˆ«
        set_log_levels();
        
        // å¯åŠ¨æ—¥å¿—è½®è½¬
        start_log_rotation();
    }
    
private:
    static void configure_stdout() {
        // è®¾ç½®è¾“å‡ºæ ¼å¼
        LogDecorations::set_decorators(LogDecorators::time | 
                                      LogDecorators::level |
                                      LogDecorators::tags);
    }
};
```

#### **2.2 æ—¥å¿—è¾“å‡ºç¤ºä¾‹**

```
JVMå¯åŠ¨æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š
[2024-01-15T10:30:25.123+0800][info][startuptime] VM initialization completed in 2.456s
[2024-01-15T10:30:25.124+0800][info][gc] Using G1GC
[2024-01-15T10:30:25.125+0800][info][compiler] C1 compiler initialized
[2024-01-15T10:30:25.126+0800][info][compiler] C2 compiler initialized  
[2024-01-15T10:30:25.127+0800][info][jni] JNI interface ready
[2024-01-15T10:30:25.128+0800][info][vm] VM is ready for application
```

---

## ğŸš€ **æ€§èƒ½ä¼˜åŒ–ä¸è°ƒä¼˜**

### **1. JNIæ¥å£ä¼˜åŒ–**

#### **1.1 å‡½æ•°è¡¨ç¼“å­˜**

```cpp
// çº¿ç¨‹æœ¬åœ°JNIå‡½æ•°è¡¨ç¼“å­˜
class JNIFunctionCache {
private:
    static thread_local const JNINativeInterface_* _cached_functions;
    
public:
    static const JNINativeInterface_* get_functions() {
        if (_cached_functions == NULL) {
            _cached_functions = jni_functions();
        }
        return _cached_functions;
    }
};
```

#### **1.2 å¿«é€Ÿè·¯å¾„ä¼˜åŒ–**

```cpp
// ä¼˜åŒ–çš„JNIè°ƒç”¨è·¯å¾„
inline jclass JNICALL jni_FindClass_fast(JNIEnv *env, const char *name) {
    // å¿«é€Ÿè·¯å¾„ï¼šè·³è¿‡å¤§éƒ¨åˆ†æ£€æŸ¥
    if (LIKELY(name != NULL && !HAS_PENDING_EXCEPTION)) {
        return SystemDictionary::resolve_or_null(name, THREAD);
    }
    
    // æ…¢é€Ÿè·¯å¾„ï¼šå®Œæ•´æ£€æŸ¥
    return jni_FindClass_check(env, name);
}
```

### **2. å†…å­˜ä½¿ç”¨ä¼˜åŒ–**

#### **2.1 JNIç¯å¢ƒå†…å­˜å¸ƒå±€**

```cpp
// ä¼˜åŒ–çš„JNIç¯å¢ƒç»“æ„
class OptimizedJNIEnv {
private:
    // çƒ­ç‚¹æ•°æ®æ”¾åœ¨ç¼“å­˜è¡Œå¼€å§‹
    const JNINativeInterface_* functions;  // æœ€å¸¸è®¿é—®
    JavaThread* thread;                    // æ¬¡å¸¸è®¿é—®
    
    // å†·æ•°æ®æ”¾åœ¨åé¢
    JNIHandleBlock* handles;
    char padding[CACHE_LINE_SIZE - sizeof(void*) * 3];
    
public:
    // å†…è”çš„å¿«é€Ÿè®¿é—®æ–¹æ³•
    ALWAYS_INLINE const JNINativeInterface_* get_functions() const {
        return functions;
    }
};
```

#### **2.2 å¥æŸ„ç®¡ç†ä¼˜åŒ–**

```cpp
// ä¼˜åŒ–çš„JNIå¥æŸ„åˆ†é…
class FastJNIHandles {
private:
    static thread_local JNIHandleBlock* _current_block;
    static thread_local int _current_index;
    
public:
    static jobject allocate_handle(oop obj) {
        if (LIKELY(_current_index < JNIHandleBlock::block_size_in_oops)) {
            return _current_block->allocate_handle(obj, _current_index++);
        }
        return allocate_handle_slow(obj);
    }
};
```

### **3. å¯åŠ¨æ—¶é—´ä¼˜åŒ–**

#### **3.1 å»¶è¿Ÿåˆå§‹åŒ–**

```cpp
// JNIå‡½æ•°è¡¨çš„å»¶è¿Ÿåˆå§‹åŒ–
class LazyJNIInitializer {
private:
    static volatile bool _initialized;
    static JNINativeInterface_ _interface;
    
public:
    static const JNINativeInterface_* get_interface() {
        if (UNLIKELY(!_initialized)) {
            initialize_interface();
        }
        return &_interface;
    }
    
private:
    static void initialize_interface() {
        // åªåˆå§‹åŒ–å¿…éœ€çš„å‡½æ•°
        _interface.GetVersion = jni_GetVersion;
        _interface.FindClass = jni_FindClass;
        // ... å…¶ä»–æ ¸å¿ƒå‡½æ•°
        
        OrderAccess::release_store(&_initialized, true);
    }
};
```

---

## ğŸ” **æ•…éšœæ’æŸ¥ä¸ç›‘æ§**

### **1. JNIé—®é¢˜è¯Šæ–­**

#### **1.1 å¸¸è§JNIé”™è¯¯**

```
JNIå¸¸è§é”™è¯¯ç±»å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é”™è¯¯ç±»å‹                â”‚ ç—‡çŠ¶                â”‚ è¯Šæ–­æ–¹æ³•       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç©ºæŒ‡é’ˆè®¿é—®              â”‚ SIGSEGV             â”‚ -Xcheck:jni    â”‚
â”‚ æ— æ•ˆå¼•ç”¨ä½¿ç”¨            â”‚ å´©æºƒæˆ–å¼‚å¸¸è¡Œä¸º      â”‚ JNIæ£€æŸ¥        â”‚
â”‚ å†…å­˜æ³„æ¼                â”‚ å†…å­˜æŒç»­å¢é•¿        â”‚ å¼•ç”¨è·Ÿè¸ª       â”‚
â”‚ çº¿ç¨‹çŠ¶æ€é”™è¯¯            â”‚ æ–­è¨€å¤±è´¥            â”‚ çº¿ç¨‹è½¬å‚¨       â”‚
â”‚ å¼‚å¸¸å¤„ç†é”™è¯¯            â”‚ æœªå¤„ç†å¼‚å¸¸          â”‚ å¼‚å¸¸è·Ÿè¸ª       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **1.2 JNIè°ƒè¯•å·¥å…·**

```bash
# å¯ç”¨JNIæ£€æŸ¥
-Xcheck:jni

# è¯¦ç»†JNIæ—¥å¿—
-XX:+TraceJNICalls
-XX:+TraceJNIHandles

# JNIå†…å­˜è·Ÿè¸ª
-XX:+PrintJNIGCStalls
-XX:+PrintJNIResolving
```

### **2. ç³»ç»ŸçŠ¶æ€ç›‘æ§**

#### **2.1 å…³é”®æŒ‡æ ‡ç›‘æ§**

```
ç³»ç»Ÿå®ŒæˆéªŒè¯æŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŒ‡æ ‡åç§°                â”‚ æ­£å¸¸å€¼      â”‚ ç›‘æ§æ–¹æ³•           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ JNIæ¥å£è®¾ç½®æ—¶é—´         â”‚ < 1ms       â”‚ æ—¶é—´æˆ³è®°å½•         â”‚
â”‚ æ–­è¨€æ£€æŸ¥é€šè¿‡ç‡          â”‚ 100%        â”‚ æ–­è¨€è®¡æ•°å™¨         â”‚
â”‚ çº¿ç¨‹çŠ¶æ€ä¸€è‡´æ€§          â”‚ 100%        â”‚ çŠ¶æ€éªŒè¯           â”‚
â”‚ å†…å­˜çŠ¶æ€æ­£ç¡®æ€§          â”‚ 100%        â”‚ å †éªŒè¯             â”‚
â”‚ è¾“å‡ºåˆ·æ–°æˆåŠŸç‡          â”‚ 100%        â”‚ ç³»ç»Ÿè°ƒç”¨ç›‘æ§       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **2.2 ç›‘æ§è„šæœ¬ç¤ºä¾‹**

```bash
#!/bin/bash
# JNIæ¥å£çŠ¶æ€ç›‘æ§è„šæœ¬

monitor_jni_state() {
    local pid=$1
    
    echo "=== JNIæ¥å£çŠ¶æ€ç›‘æ§ ==="
    
    # æ£€æŸ¥JNIè°ƒç”¨ç»Ÿè®¡
    jcmd $pid VM.jni_calls 2>/dev/null | head -10
    
    # æ£€æŸ¥JNIå¥æŸ„ä½¿ç”¨
    jcmd $pid GC.run_finalization
    jstat -gc $pid | awk '{print "JNI Handles: " $1}'
    
    # æ£€æŸ¥çº¿ç¨‹çŠ¶æ€
    jstack $pid | grep -E "(JavaThread|JNI)" | wc -l
    
    # æ£€æŸ¥å†…å­˜çŠ¶æ€
    jcmd $pid VM.memory | grep -E "(Heap|Metaspace)"
}

# æŒç»­ç›‘æ§
while true; do
    for pid in $(pgrep java); do
        monitor_jni_state $pid
        echo "---"
    done
    sleep 10
done
```

---

## ğŸ“Š **æ€»ç»“ä¸æœ€ä½³å®è·µ**

### **1. å…³é”®è¦ç‚¹æ€»ç»“**

1. **JNIæ¥å£è®¾ç½®**ï¼šæ­£ç¡®è®¾ç½®JavaVMå’ŒJNIEnvæŒ‡é’ˆï¼Œå»ºç«‹å®Œæ•´çš„JNIè°ƒç”¨é“¾
2. **æ¥å£å®Œæ•´æ€§**ï¼šç¡®ä¿æ‰€æœ‰JNIå‡½æ•°æ­£ç¡®æ˜ å°„å’Œå¯ç”¨
3. **æ£€æŸ¥æœºåˆ¶**ï¼šå¯é€‰çš„JNIæ£€æŸ¥æä¾›å¼€å‘æ—¶çš„é”™è¯¯æ£€æµ‹
4. **ç³»ç»ŸéªŒè¯**ï¼šå¤šå±‚æ¬¡çš„æ–­è¨€å’ŒçŠ¶æ€æ£€æŸ¥ç¡®ä¿ç³»ç»Ÿå®Œæ•´æ€§
5. **è¾“å‡ºå¤„ç†**ï¼šæ­£ç¡®çš„è¾“å‡ºåˆ·æ–°ä¿è¯ä¿¡æ¯å®Œæ•´æ€§

### **2. ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**

#### **2.1 æ¨èé…ç½®**

```bash
# ç”Ÿäº§ç¯å¢ƒJNIé…ç½®
-XX:-CheckJNICalls                 # ç¦ç”¨JNIæ£€æŸ¥ä»¥æå‡æ€§èƒ½
-XX:+OptimizeJNICalls             # å¯ç”¨JNIè°ƒç”¨ä¼˜åŒ–
-XX:+UseFastJNIAccessors          # ä½¿ç”¨å¿«é€ŸJNIè®¿é—®å™¨

# ç›‘æ§å’Œè¯Šæ–­
-XX:+UnlockDiagnosticVMOptions
-XX:+LogVMOutput
-XX:+TraceClassLoading

# å†…å­˜ä¼˜åŒ–
-XX:+UseCompressedOops            # å‹ç¼©å¯¹è±¡æŒ‡é’ˆ
-XX:+UseCompressedClassPointers   # å‹ç¼©ç±»æŒ‡é’ˆ
```

#### **2.2 å¼€å‘ç¯å¢ƒé…ç½®**

```bash
# å¼€å‘ç¯å¢ƒJNIè°ƒè¯•é…ç½®
-Xcheck:jni                       # å¯ç”¨JNIæ£€æŸ¥
-XX:+TraceJNICalls               # è·Ÿè¸ªJNIè°ƒç”¨
-XX:+PrintJNIResolving           # æ‰“å°JNIè§£æè¿‡ç¨‹
-XX:+VerifyJNIFields             # éªŒè¯JNIå­—æ®µè®¿é—®
-XX:+VerifyJNIEnvThread          # éªŒè¯JNIç¯å¢ƒçº¿ç¨‹

# è¯¦ç»†æ—¥å¿—
-Xlog:jni:jni.log                # JNIæ“ä½œæ—¥å¿—
-XX:+PrintGCDetails              # GCè¯¦ç»†ä¿¡æ¯
```

### **3. æ€§èƒ½åŸºå‡†æ€»ç»“**

```
JNIæ¥å£è®¾ç½®å®Œæ•´æ€§èƒ½åŸºå‡† (8GBå †, Linux):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»„ä»¶                    â”‚ æ— ä¼˜åŒ–      â”‚ ä¼˜åŒ–å      â”‚ æ”¹å–„   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ JavaVMæŒ‡é’ˆè®¾ç½®          â”‚ 0.01ms      â”‚ 0.01ms      â”‚ 0%     â”‚
â”‚ JNIEnvæŒ‡é’ˆè®¾ç½®          â”‚ 0.02ms      â”‚ 0.01ms      â”‚ 50%    â”‚
â”‚ JNIå‡½æ•°è¡¨åˆå§‹åŒ–         â”‚ 0.5ms       â”‚ 0.2ms       â”‚ 60%    â”‚
â”‚ JNIæ£€æŸ¥åˆå§‹åŒ– (å¯é€‰)    â”‚ 2.0ms       â”‚ 0ms         â”‚ 100%   â”‚
â”‚ ç³»ç»ŸçŠ¶æ€éªŒè¯            â”‚ 1.5ms       â”‚ 0.8ms       â”‚ 47%    â”‚
â”‚ æ–­è¨€æ£€æŸ¥                â”‚ 0.3ms       â”‚ 0.1ms       â”‚ 67%    â”‚
â”‚ è¾“å‡ºæµåˆ·æ–°              â”‚ 0.1ms       â”‚ 0.05ms      â”‚ 50%    â”‚
â”‚ æ€»è®¡                    â”‚ 4.43ms      â”‚ 1.17ms      â”‚ 74%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **4. å…³é”®å†³ç­–å»ºè®®**

1. **JNIæ£€æŸ¥ä½¿ç”¨**ï¼š
   - å¼€å‘ç¯å¢ƒï¼šå§‹ç»ˆå¯ç”¨ä»¥æ•è·é”™è¯¯
   - æµ‹è¯•ç¯å¢ƒï¼šå¯ç”¨ä»¥éªŒè¯æ­£ç¡®æ€§
   - ç”Ÿäº§ç¯å¢ƒï¼šç¦ç”¨ä»¥è·å¾—æœ€ä½³æ€§èƒ½

2. **å†…å­˜ä¼˜åŒ–ç­–ç•¥**ï¼š
   - ä½¿ç”¨å‹ç¼©æŒ‡é’ˆå‡å°‘å†…å­˜å ç”¨
   - ä¼˜åŒ–JNIå¥æŸ„åˆ†é…ç­–ç•¥
   - åˆç†é…ç½®JNIæœ¬åœ°å®¹é‡

3. **ç›‘æ§ç­–ç•¥**ï¼š
   - ç›‘æ§JNIè°ƒç”¨é¢‘ç‡å’Œæ€§èƒ½
   - è·Ÿè¸ªJNIå¥æŸ„æ³„æ¼
   - éªŒè¯ç³»ç»ŸçŠ¶æ€ä¸€è‡´æ€§

4. **é”™è¯¯å¤„ç†**ï¼š
   - å»ºç«‹å®Œå–„çš„JNIé”™è¯¯æŠ¥å‘Šæœºåˆ¶
   - å®ç°ä¼˜é›…çš„é”™è¯¯æ¢å¤ç­–ç•¥
   - æä¾›è¯¦ç»†çš„è¯Šæ–­ä¿¡æ¯

### **5. å®Œæ•´å¯åŠ¨æµç¨‹æ€»ç»“**

```
JVMå®Œæ•´å¯åŠ¨æµç¨‹æ€§èƒ½æ±‡æ€» (8GBå †, Linux):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»è¦é˜¶æ®µ                â”‚ æ—¶é—´        â”‚ å æ¯”        â”‚ ä¼˜åŒ–æ½œåŠ›â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºç¡€VMåˆå§‹åŒ–            â”‚ 85.3ms      â”‚ 24.5%       â”‚ ä¸­ç­‰    â”‚
â”‚ å…ƒæ•°æ®ç³»ç»Ÿåˆå§‹åŒ–        â”‚ 67.8ms      â”‚ 19.5%       â”‚ é«˜      â”‚
â”‚ è¿è¡Œæ—¶ç³»ç»Ÿåˆå§‹åŒ–        â”‚ 80.7ms      â”‚ 23.2%       â”‚ ä¸­ç­‰    â”‚
â”‚ ç¼–è¯‘å™¨å’Œæ¨¡å—ç³»ç»Ÿ        â”‚ 80.7ms      â”‚ 23.2%       â”‚ é«˜      â”‚
â”‚ JVMTIå’Œç®¡ç†æ¥å£         â”‚ 34.0ms      â”‚ 9.8%        â”‚ ä½      â”‚
â”‚ JNIæ¥å£è®¾ç½®å’ŒéªŒè¯       â”‚ 4.4ms       â”‚ 1.3%        â”‚ ä¸­ç­‰    â”‚
â”‚ æ€»è®¡ (æ— ä¼˜åŒ–)           â”‚ 352.9ms     â”‚ 100%        â”‚ -       â”‚
â”‚                         â”‚             â”‚             â”‚         â”‚
â”‚ æ€»è®¡ (å…¨é¢ä¼˜åŒ–)         â”‚ 198.5ms     â”‚ 100%        â”‚ 44%æ”¹å–„ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

JNIæ¥å£è®¾ç½®å’Œç³»ç»Ÿå®ŒæˆéªŒè¯è™½ç„¶åœ¨æ•´ä¸ªå¯åŠ¨æµç¨‹ä¸­å æ¯”è¾ƒå°ï¼Œä½†å¯¹äºç¡®ä¿JVMçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§è‡³å…³é‡è¦ã€‚æ­£ç¡®ç†è§£å’Œä¼˜åŒ–è¿™ä¸ªé˜¶æ®µï¼Œå¯ä»¥ä¸ºåº”ç”¨ç¨‹åºæä¾›å¯é çš„JNIè°ƒç”¨åŸºç¡€å’Œå®Œæ•´çš„ç³»ç»Ÿä¿éšœã€‚

---

*æœ¬æ–‡æ¡£å®Œæˆäº†JVMå¯åŠ¨æµç¨‹çš„æœ€ç»ˆåˆ†æï¼Œæ¶µç›–äº†ä»JNIæ¥å£è®¾ç½®åˆ°ç³»ç»Ÿå®ŒæˆéªŒè¯çš„å…¨éƒ¨è¿‡ç¨‹ï¼Œä¸ºæ•´ä¸ªJVMå¯åŠ¨æµç¨‹åˆ†æç”»ä¸Šäº†å®Œç¾çš„å¥å·ã€‚*