# JVMåˆ›å»ºå®Œæˆåçš„å¯¹è±¡å…¨æ™¯å›¾ - æ€»è§ˆç¯‡

## ğŸ“‹ **æ–‡æ¡£æ¦‚è¿°**

æœ¬æ–‡æ¡£ç³»ç»Ÿæ€§åœ°åˆ†æ`JNI_CreateJavaVM_inner`æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼ŒJVMä¸­åˆ›å»ºçš„æ‰€æœ‰æ ¸å¿ƒå¯¹è±¡ã€å®ƒä»¬çš„ä½œç”¨ä»¥åŠç›¸äº’å…³ç³»ã€‚è¿™æ˜¯ç†è§£JVMå†…éƒ¨ç»“æ„çš„å…³é”®æ–‡æ¡£ã€‚

### **ğŸ¯ åˆ†æç¯å¢ƒ**
- **æ“ä½œç³»ç»Ÿ**: Linux x86_64
- **JVMç‰ˆæœ¬**: OpenJDK 11
- **å †å¤§å°**: 8GB (-Xms8g -Xmx8g)
- **GCæ”¶é›†å™¨**: G1GC (JDK 11é»˜è®¤)
- **å¤§é¡µ**: ç¦ç”¨ (é»˜è®¤é…ç½®)

---

## ğŸ—ï¸ **1. JVMå¯¹è±¡åˆ†ç±»æ€»è§ˆ**

JVMåˆ›å»ºå®Œæˆåï¼Œæ‰€æœ‰å¯¹è±¡å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ å¤§ç±»ï¼š

```
JVMå¯¹è±¡åˆ†ç±»ä½“ç³»:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           JVMæ ¸å¿ƒå¯¹è±¡åˆ†ç±»                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  1. å†…å­˜ç®¡ç†    â”‚  â”‚  2. çº¿ç¨‹ç®¡ç†    â”‚  â”‚  3. ç±»åŠ è½½ç³»ç»Ÿ  â”‚             â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚             â”‚
â”‚  â”‚ â€¢ Universe      â”‚  â”‚ â€¢ Threads       â”‚  â”‚ â€¢ SystemDict    â”‚             â”‚
â”‚  â”‚ â€¢ G1Heap        â”‚  â”‚ â€¢ VMThread      â”‚  â”‚ â€¢ ClassLoader   â”‚             â”‚
â”‚  â”‚ â€¢ Metaspace     â”‚  â”‚ â€¢ JavaThread    â”‚  â”‚ â€¢ SymbolTable   â”‚             â”‚
â”‚  â”‚ â€¢ CodeCache     â”‚  â”‚ â€¢ ServiceThread â”‚  â”‚ â€¢ StringTable   â”‚             â”‚
â”‚  â”‚ â€¢ CardTable     â”‚  â”‚ â€¢ WatcherThread â”‚  â”‚ â€¢ ConstantPool  â”‚             â”‚
â”‚  â”‚ â€¢ TLAB          â”‚  â”‚ â€¢ CompilerThreadâ”‚  â”‚                 â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  4. å¯¹è±¡æ¨¡å‹    â”‚  â”‚  5. åŒæ­¥æœºåˆ¶    â”‚  â”‚  6. ç¼–è¯‘ç³»ç»Ÿ    â”‚             â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚             â”‚
â”‚  â”‚ â€¢ oopDesc       â”‚  â”‚ â€¢ ObjectMonitor â”‚  â”‚ â€¢ CompileBroker â”‚             â”‚
â”‚  â”‚ â€¢ markOop       â”‚  â”‚ â€¢ SafepointSync â”‚  â”‚ â€¢ C1/C2ç¼–è¯‘å™¨   â”‚             â”‚
â”‚  â”‚ â€¢ Klass         â”‚  â”‚ â€¢ Mutex/Monitor â”‚  â”‚ â€¢ nmethod       â”‚             â”‚
â”‚  â”‚ â€¢ InstanceKlass â”‚  â”‚                 â”‚  â”‚ â€¢ CodeHeap      â”‚             â”‚
â”‚  â”‚ â€¢ Method        â”‚  â”‚                 â”‚  â”‚                 â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚  7. GCç³»ç»Ÿ      â”‚  â”‚  8. æœåŠ¡ä¸ç›‘æ§  â”‚                                  â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚                                  â”‚
â”‚  â”‚ â€¢ G1ConcMark    â”‚  â”‚ â€¢ JvmtiExport   â”‚                                  â”‚
â”‚  â”‚ â€¢ G1RemSet      â”‚  â”‚ â€¢ Management    â”‚                                  â”‚
â”‚  â”‚ â€¢ HeapRegion    â”‚  â”‚ â€¢ PerfCounters  â”‚                                  â”‚
â”‚  â”‚ â€¢ RefProcessor  â”‚  â”‚ â€¢ Logging       â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š **2. æ ¸å¿ƒå¯¹è±¡æ•°é‡ç»Ÿè®¡**

åœ¨8GBå †ã€G1GCé…ç½®ä¸‹ï¼ŒJVMåˆ›å»ºå®Œæˆåçš„å¯¹è±¡æ•°é‡ç»Ÿè®¡ï¼š

### **2.1 å•ä¾‹å¯¹è±¡ (å…¨å±€å”¯ä¸€)**

| å¯¹è±¡ç±»å‹ | å®ä¾‹æ•° | å†…å­˜å ç”¨ | è¯´æ˜ |
|---------|--------|---------|------|
| **Universe** | 1 (é™æ€ç±») | ~2KB | å…¨å±€å‘½åç©ºé—´ï¼ŒæŒæœ‰æ‰€æœ‰ç³»ç»Ÿå¼•ç”¨ |
| **G1CollectedHeap** | 1 | ~8KB | G1å †ç®¡ç†å™¨ |
| **Metaspace** | 1 (é™æ€ç±») | ~1KB | å…ƒç©ºé—´ç®¡ç†å™¨ |
| **CodeCache** | 1 (é™æ€ç±») | ~2KB | ä»£ç ç¼“å­˜ç®¡ç†å™¨ |
| **SystemDictionary** | 1 (é™æ€ç±») | ~4KB | ç³»ç»Ÿç±»å­—å…¸ |
| **SymbolTable** | 1 | ~64KB | ç¬¦å·è¡¨ |
| **StringTable** | 1 | ~32KB | å­—ç¬¦ä¸²å¸¸é‡æ±  |
| **VMThread** | 1 | ~4KB | VMæ“ä½œçº¿ç¨‹ |
| **ServiceThread** | 1 | ~4KB | æœåŠ¡çº¿ç¨‹ |
| **WatcherThread** | 1 | ~4KB | ç›‘æ§çº¿ç¨‹ |
| **CompileBroker** | 1 (é™æ€ç±») | ~2KB | ç¼–è¯‘ä»£ç† |
| **SafepointSynchronize** | 1 (é™æ€ç±») | ~1KB | å®‰å…¨ç‚¹åŒæ­¥å™¨ |
| **JvmtiExport** | 1 (é™æ€ç±») | ~1KB | JVMTIå¯¼å‡ºæ¥å£ |
| **Management** | 1 (é™æ€ç±») | ~1KB | JMXç®¡ç†æ¥å£ |

### **2.2 å¤šå®ä¾‹å¯¹è±¡**

| å¯¹è±¡ç±»å‹ | å®ä¾‹æ•° | å•ä¸ªå¤§å° | æ€»å†…å­˜ | è¯´æ˜ |
|---------|--------|---------|--------|------|
| **HeapRegion** | ~4096 | ~256B | ~1MB | G1å †åŒºåŸŸ (8GB/2MB) |
| **ClassLoaderData** | 3+ | ~1KB | ~3KB | ç±»åŠ è½½å™¨æ•°æ® |
| **InstanceKlass** | ~1500 | ~1KB | ~1.5MB | å·²åŠ è½½çš„ç±»å…ƒæ•°æ® |
| **Method** | ~15000 | ~200B | ~3MB | æ–¹æ³•å…ƒæ•°æ® |
| **ConstantPool** | ~1500 | ~2KB | ~3MB | å¸¸é‡æ±  |
| **CompilerThread** | 4-8 | ~4KB | ~32KB | ç¼–è¯‘çº¿ç¨‹ |
| **JavaThread** | 1 | ~8KB | ~8KB | ä¸»çº¿ç¨‹ |
| **CodeHeap** | 3 | ~100B | ~300B | ä»£ç å † |
| **G1CMTask** | 8+ | ~1KB | ~8KB | å¹¶å‘æ ‡è®°ä»»åŠ¡ |

### **2.3 å†…å­˜åŒºåŸŸåˆ†é…**

| åŒºåŸŸ | å¤§å° | è¯´æ˜ |
|------|------|------|
| **Javaå †** | 8GB | å¯¹è±¡åˆ†é…åŒºåŸŸ |
| **Metaspace** | ~20MBåˆå§‹ | ç±»å…ƒæ•°æ® |
| **CodeCache** | ~240MB | ç¼–è¯‘ä»£ç  |
| **çº¿ç¨‹æ ˆ** | ~10MB | æ‰€æœ‰çº¿ç¨‹æ ˆæ€»å’Œ |
| **ç›´æ¥å†…å­˜** | æŒ‰éœ€ | NIOç›´æ¥ç¼“å†²åŒº |

---

## ğŸ”— **3. æ ¸å¿ƒå¯¹è±¡å…³ç³»å›¾**

### **3.1 é¡¶å±‚æ¶æ„å…³ç³»**

```
                              JNI_CreateJavaVM_inner
                                       â”‚
                                       â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚            Universe (å…¨å±€å…¥å£)        â”‚
                    â”‚                                      â”‚
                    â”‚  _collectedHeap â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º G1CollectedHeap
                    â”‚  _main_thread_group â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º oop (ThreadGroup)
                    â”‚  _system_thread_group â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º oop (ThreadGroup)
                    â”‚  _out_of_memory_error_* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º é¢„åˆ†é…çš„OOMå¯¹è±¡
                    â”‚  _typeArrayKlassObjs[] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º åŸºæœ¬ç±»å‹æ•°ç»„Klass
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                           â”‚                           â”‚
           â–¼                           â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Threads   â”‚           â”‚ Metaspace   â”‚           â”‚  CodeCache  â”‚
    â”‚             â”‚           â”‚             â”‚           â”‚             â”‚
    â”‚ _thread_listâ”‚           â”‚ _space_list â”‚           â”‚ _heaps[]    â”‚
    â”‚ _number_of_ â”‚           â”‚ _class_spaceâ”‚           â”‚ _low_bound  â”‚
    â”‚   threads   â”‚           â”‚   _list     â”‚           â”‚ _high_bound â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                           â”‚                           â”‚
           â–¼                           â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ JavaThread  â”‚           â”‚ClassLoader  â”‚           â”‚  CodeHeap   â”‚
    â”‚ VMThread    â”‚           â”‚   Data      â”‚           â”‚  (3ä¸ª)      â”‚
    â”‚ Service...  â”‚           â”‚             â”‚           â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3.2 G1å †å†…éƒ¨ç»“æ„**

```
G1CollectedHeap
       â”‚
       â”œâ”€â”€ _hrm (HeapRegionManager)
       â”‚         â”‚
       â”‚         â””â”€â”€ HeapRegion[0..4095] â”€â”€â–º æ¯ä¸ª2MB
       â”‚                   â”‚
       â”‚                   â”œâ”€â”€ _type (Eden/Survivor/Old/Humongous)
       â”‚                   â”œâ”€â”€ _rem_set (HeapRegionRemSet)
       â”‚                   â””â”€â”€ _bot_part (BlockOffsetTable)
       â”‚
       â”œâ”€â”€ _allocator (G1Allocator)
       â”‚         â”‚
       â”‚         â””â”€â”€ ç®¡ç†TLABå’Œéå·¨å‹å¯¹è±¡åˆ†é…
       â”‚
       â”œâ”€â”€ _cm (G1ConcurrentMark)
       â”‚         â”‚
       â”‚         â”œâ”€â”€ _mark_bitmap_1/_mark_bitmap_2 (åŒç¼“å†²)
       â”‚         â”œâ”€â”€ _global_mark_stack (ç°è‰²å¯¹è±¡æ ˆ)
       â”‚         â””â”€â”€ _tasks[] (å¹¶è¡Œæ ‡è®°ä»»åŠ¡)
       â”‚
       â”œâ”€â”€ _g1_rem_set (G1RemSet)
       â”‚         â”‚
       â”‚         â”œâ”€â”€ _ct (G1CardTable)
       â”‚         â””â”€â”€ _hot_card_cache
       â”‚
       â”œâ”€â”€ _g1_policy (G1Policy)
       â”‚         â”‚
       â”‚         â””â”€â”€ æ”¶é›†ç­–ç•¥å’Œé¢„æµ‹æ¨¡å‹
       â”‚
       â”œâ”€â”€ _collection_set (G1CollectionSet)
       â”‚
       â””â”€â”€ _ref_processor_stw/_ref_processor_cm (ReferenceProcessor)
```

### **3.3 ç±»åŠ è½½ç³»ç»Ÿç»“æ„**

```
SystemDictionary (é™æ€ç±»)
       â”‚
       â”œâ”€â”€ _well_known_klasses[] â”€â”€â–º çŸ¥åç±»æ•°ç»„
       â”‚         â”‚
       â”‚         â”œâ”€â”€ Object_klass
       â”‚         â”œâ”€â”€ String_klass
       â”‚         â”œâ”€â”€ Class_klass
       â”‚         â”œâ”€â”€ Thread_klass
       â”‚         â””â”€â”€ ... (çº¦100ä¸ª)
       â”‚
       â”œâ”€â”€ _java_system_loader â”€â”€â–º ç³»ç»Ÿç±»åŠ è½½å™¨
       â”œâ”€â”€ _java_platform_loader â”€â”€â–º å¹³å°ç±»åŠ è½½å™¨
       â”‚
       â””â”€â”€ é€šè¿‡ClassLoaderDataGraphè®¿é—®æ‰€æœ‰CLD
                    â”‚
                    â–¼
           ClassLoaderDataGraph
                    â”‚
                    â””â”€â”€ _head â”€â”€â–º ClassLoaderDataé“¾è¡¨
                                       â”‚
                                       â”œâ”€â”€ Bootstrap CLD (null loader)
                                       â”‚         â”‚
                                       â”‚         â”œâ”€â”€ _klasses â”€â”€â–º Klassé“¾è¡¨
                                       â”‚         â”œâ”€â”€ _dictionary â”€â”€â–º ç±»å­—å…¸
                                       â”‚         â””â”€â”€ _metaspace â”€â”€â–º å…ƒç©ºé—´
                                       â”‚
                                       â”œâ”€â”€ Platform CLD
                                       â”‚
                                       â””â”€â”€ System CLD
```

### **3.4 çº¿ç¨‹ç³»ç»Ÿç»“æ„**

```
Threads (é™æ€ç±»)
       â”‚
       â””â”€â”€ _thread_list â”€â”€â–º JavaThreadé“¾è¡¨
                                 â”‚
                                 â”œâ”€â”€ main_thread (ä¸»çº¿ç¨‹)
                                 â”‚         â”‚
                                 â”‚         â”œâ”€â”€ _threadObj â”€â”€â–º java.lang.Thread
                                 â”‚         â”œâ”€â”€ _jni_environment â”€â”€â–º JNIEnv
                                 â”‚         â”œâ”€â”€ _tlab â”€â”€â–º ThreadLocalAllocBuffer
                                 â”‚         â”œâ”€â”€ _anchor â”€â”€â–º JavaFrameAnchor
                                 â”‚         â”œâ”€â”€ _thread_state â”€â”€â–º çº¿ç¨‹çŠ¶æ€
                                 â”‚         â””â”€â”€ _osthread â”€â”€â–º OSThread
                                 â”‚
                                 â””â”€â”€ (åç»­åˆ›å»ºçš„Javaçº¿ç¨‹)

VMThread (å•ä¾‹)
       â”‚
       â”œâ”€â”€ _vm_queue â”€â”€â–º VMOperationQueue
       â”‚         â”‚
       â”‚         â””â”€â”€ VM_Operationé“¾è¡¨ (GCã€åå‘é”æ’¤é”€ç­‰)
       â”‚
       â””â”€â”€ _cur_vm_operation â”€â”€â–º å½“å‰æ‰§è¡Œçš„VMæ“ä½œ

ServiceThread (å•ä¾‹)
       â”‚
       â””â”€â”€ _jvmti_service_queue â”€â”€â–º JVMTIäº‹ä»¶é˜Ÿåˆ—

WatcherThread (å•ä¾‹)
       â”‚
       â””â”€â”€ å‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œ (æ¯10ms)

CompilerThread[0..N]
       â”‚
       â”œâ”€â”€ _compiler â”€â”€â–º AbstractCompiler (C1/C2)
       â”œâ”€â”€ _task â”€â”€â–º CompileTask
       â””â”€â”€ _queue â”€â”€â–º CompileQueue
```

---

## ğŸ“ˆ **4. å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸åˆ›å»ºæ—¶æœº**

### **4.1 åˆ›å»ºé¡ºåºæ—¶é—´çº¿**

```
JNI_CreateJavaVM_inner æ‰§è¡Œæ—¶é—´çº¿:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¶é—´(ms)  â”‚ åˆ›å»ºçš„å¯¹è±¡                           â”‚ ä¾èµ–å…³ç³»                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0-5      â”‚ os::init() - æ“ä½œç³»ç»ŸæŠ½è±¡å±‚åˆå§‹åŒ–                                â”‚
â”‚          â”‚ â€¢ OSThreadç»“æ„                                                   â”‚
â”‚          â”‚ â€¢ ä¿¡å·å¤„ç†å™¨                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5-15     â”‚ Arguments::parse() - å‚æ•°è§£æ                                    â”‚
â”‚          â”‚ â€¢ VMå‚æ•°ç»“æ„                                                     â”‚
â”‚          â”‚ â€¢ ç³»ç»Ÿå±æ€§è¡¨                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 15-25    â”‚ ostream_init() - è¾“å‡ºæµåˆå§‹åŒ–                                    â”‚
â”‚          â”‚ â€¢ gclogæ–‡ä»¶æµ                                                    â”‚
â”‚          â”‚ â€¢ æ—¥å¿—ç³»ç»Ÿ                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 25-50    â”‚ os::init_2() - ç¬¬äºŒé˜¶æ®µOSåˆå§‹åŒ–                                  â”‚
â”‚          â”‚ â€¢ å†…å­˜æ˜ å°„ç»“æ„                                                   â”‚
â”‚          â”‚ â€¢ å¤§é¡µé…ç½®                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 50-80    â”‚ Universe::initialize_heap() - å †åˆå§‹åŒ–                           â”‚
â”‚          â”‚ â€¢ G1CollectedHeap                     â”‚ éœ€è¦os::init_2å®Œæˆ       â”‚
â”‚          â”‚ â€¢ HeapRegion[4096]                    â”‚                          â”‚
â”‚          â”‚ â€¢ G1CardTable                         â”‚                          â”‚
â”‚          â”‚ â€¢ G1RemSet                            â”‚                          â”‚
â”‚          â”‚ â€¢ G1ConcurrentMark                    â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 80-100   â”‚ Metaspace::global_initialize() - å…ƒç©ºé—´åˆå§‹åŒ–                    â”‚
â”‚          â”‚ â€¢ VirtualSpaceList                    â”‚ éœ€è¦å †åˆå§‹åŒ–å®Œæˆ         â”‚
â”‚          â”‚ â€¢ ChunkManager                        â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 100-120  â”‚ CodeCache::initialize() - ä»£ç ç¼“å­˜åˆå§‹åŒ–                         â”‚
â”‚          â”‚ â€¢ CodeHeap (non-nmethods)             â”‚                          â”‚
â”‚          â”‚ â€¢ CodeHeap (profiled)                 â”‚                          â”‚
â”‚          â”‚ â€¢ CodeHeap (non-profiled)             â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 120-130  â”‚ main_threadåˆ›å»º                                                  â”‚
â”‚          â”‚ â€¢ JavaThread                          â”‚ éœ€è¦å †å¯ç”¨               â”‚
â”‚          â”‚ â€¢ JNIEnv                              â”‚                          â”‚
â”‚          â”‚ â€¢ ThreadLocalAllocBuffer              â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 130-150  â”‚ VMThread::create() - VMçº¿ç¨‹åˆ›å»º                                  â”‚
â”‚          â”‚ â€¢ VMThread                            â”‚ éœ€è¦main_thread          â”‚
â”‚          â”‚ â€¢ VMOperationQueue                    â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 150-200  â”‚ initialize_java_lang_classes() - Javaæ ¸å¿ƒç±»åˆå§‹åŒ–                â”‚
â”‚          â”‚ â€¢ InstanceKlass (Object, String...)   â”‚ éœ€è¦VMThread             â”‚
â”‚          â”‚ â€¢ Method, ConstMethod                 â”‚                          â”‚
â”‚          â”‚ â€¢ ConstantPool                        â”‚                          â”‚
â”‚          â”‚ â€¢ SymbolTableå¡«å……                     â”‚                          â”‚
â”‚          â”‚ â€¢ StringTableå¡«å……                     â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 200-220  â”‚ CompileBroker::compilation_init() - ç¼–è¯‘ç³»ç»Ÿåˆå§‹åŒ–               â”‚
â”‚          â”‚ â€¢ CompilerThread[0..N]                â”‚ éœ€è¦ç±»åŠ è½½ç³»ç»Ÿ           â”‚
â”‚          â”‚ â€¢ CompileQueue                        â”‚                          â”‚
â”‚          â”‚ â€¢ C1/C2ç¼–è¯‘å™¨å®ä¾‹                     â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 220-240  â”‚ ServiceThread/WatcherThreadåˆå§‹åŒ–                                â”‚
â”‚          â”‚ â€¢ ServiceThread                       â”‚ éœ€è¦ç¼–è¯‘ç³»ç»Ÿ             â”‚
â”‚          â”‚ â€¢ WatcherThread                       â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 240-280  â”‚ æ¨¡å—ç³»ç»Ÿåˆå§‹åŒ– (call_initPhase2/3)                               â”‚
â”‚          â”‚ â€¢ ModuleEntry                         â”‚                          â”‚
â”‚          â”‚ â€¢ PackageEntry                        â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 280-300  â”‚ Management::initialize() - JMXåˆå§‹åŒ–                             â”‚
â”‚          â”‚ â€¢ MemoryPool MXBean                   â”‚                          â”‚
â”‚          â”‚ â€¢ GarbageCollector MXBean             â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 300+     â”‚ JVMå®Œå…¨å°±ç»ªï¼Œè¿”å›JNI_OK                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **4.2 å¯¹è±¡ä¾èµ–å…³ç³»å›¾**

```
ä¾èµ–å…³ç³» (ç®­å¤´è¡¨ç¤º"ä¾èµ–äº"):

os::init() â—„â”€â”€â”€ Universe â—„â”€â”€â”€ Threads â—„â”€â”€â”€ VMThread
                   â”‚              â”‚            â”‚
                   â”‚              â”‚            â–¼
                   â”‚              â”‚      ServiceThread
                   â”‚              â”‚      WatcherThread
                   â”‚              â”‚
                   â–¼              â–¼
            G1CollectedHeap   JavaThread â—„â”€â”€â”€ CompilerThread
                   â”‚              â”‚
                   â”‚              â–¼
                   â”‚         SystemDictionary â—„â”€â”€â”€ ClassLoaderData
                   â”‚              â”‚
                   â–¼              â–¼
              Metaspace      InstanceKlass â—„â”€â”€â”€ Method
                   â”‚              â”‚              â”‚
                   â–¼              â–¼              â–¼
             CodeCache      ConstantPool    ConstMethod
                   â”‚
                   â–¼
              nmethod (è¿è¡Œæ—¶åˆ›å»º)
```

---

## ğŸ¯ **5. å…³é”®å¯¹è±¡è¯¦è§£ç´¢å¼•**

æœ¬æ–‡æ¡£æ˜¯æ€»è§ˆç¯‡ï¼Œè¯¦ç»†çš„å¯¹è±¡åˆ†æè¯·å‚é˜…ä»¥ä¸‹ä¸“é¢˜æ–‡æ¡£ï¼š

| æ–‡æ¡£åç§° | è¦†ç›–å†…å®¹ |
|---------|---------|
| **jvm_memory_management_objects.md** | Universeã€G1CollectedHeapã€Metaspaceã€CodeCacheã€HeapRegionã€TLAB |
| **jvm_thread_system_objects.md** | Threadsã€JavaThreadã€VMThreadã€ServiceThreadã€WatcherThreadã€CompilerThread |
| **jvm_class_loading_objects.md** | SystemDictionaryã€ClassLoaderDataã€InstanceKlassã€Methodã€ConstantPool |
| **jvm_object_model_and_synchronization.md** | oopDescã€markOopã€Klassã€ObjectMonitorã€SafepointSynchronize |
| **jvm_gc_system_objects.md** | G1ConcurrentMarkã€G1RemSetã€CardTableã€ReferenceProcessor |
| **jvm_compilation_and_services.md** | CompileBrokerã€nmethodã€JvmtiExportã€Management |

---

## ğŸ“Š **6. å†…å­˜å¸ƒå±€æ€»è§ˆ**

### **6.1 JVMè¿›ç¨‹å†…å­˜å¸ƒå±€**

```
JVMè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´å¸ƒå±€ (Linux x86_64, 8GBå †):

é«˜åœ°å€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å†…æ ¸ç©ºé—´ (ä¸å¯è®¿é—®)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 0x7FFF_FFFF_FFFF
â”‚                                                             â”‚
â”‚                    ç”¨æˆ·æ ˆåŒºåŸŸ                                â”‚
â”‚                    (çº¿ç¨‹æ ˆï¼Œå‘ä¸‹å¢é•¿)                         â”‚
â”‚                    ~10MB (æ‰€æœ‰çº¿ç¨‹)                          â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                    å†…å­˜æ˜ å°„åŒºåŸŸ                              â”‚
â”‚                    â€¢ libjvm.so (~20MB)                      â”‚
â”‚                    â€¢ libc.so                                â”‚
â”‚                    â€¢ å…¶ä»–å…±äº«åº“                              â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                    Javaå † (G1)                              â”‚
â”‚                    8GB (è¿ç»­è™šæ‹Ÿåœ°å€)                        â”‚
â”‚                    â€¢ 4096ä¸ªHeapRegion                       â”‚
â”‚                    â€¢ æ¯ä¸ªRegion 2MB                         â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                    Metaspace                                â”‚
â”‚                    ~20MBåˆå§‹ï¼ŒæŒ‰éœ€å¢é•¿                       â”‚
â”‚                    â€¢ ç±»å…ƒæ•°æ®                               â”‚
â”‚                    â€¢ æ–¹æ³•å…ƒæ•°æ®                             â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                    CodeCache                                â”‚
â”‚                    ~240MB                                   â”‚
â”‚                    â€¢ non-nmethods: ~5MB                     â”‚
â”‚                    â€¢ profiled nmethods: ~120MB              â”‚
â”‚                    â€¢ non-profiled nmethods: ~120MB          â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                    å‹ç¼©ç±»ç©ºé—´                                â”‚
â”‚                    ~1GB (CompressedClassSpaceSize)          â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                    Cå † (mallocåŒºåŸŸ)                         â”‚
â”‚                    â€¢ JVMå†…éƒ¨æ•°æ®ç»“æ„                        â”‚
â”‚                    â€¢ ç¬¦å·è¡¨ã€å­—ç¬¦ä¸²è¡¨                        â”‚
â”‚                    â€¢ ç¼–è¯‘å™¨æ•°æ®                             â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ç¨‹åºæ•°æ®æ®µ (.data, .bss)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ç¨‹åºä»£ç æ®µ (.text)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 0x0000_0000_0000
ä½åœ°å€
```

### **6.2 G1å †å†…éƒ¨å¸ƒå±€**

```
G1å †åŒºåŸŸå¸ƒå±€ (8GB, 4096ä¸ªRegion):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Region 0    â”‚ Region 1    â”‚ Region 2    â”‚ ... â”‚ Region 4095â”‚
â”‚ (Eden)      â”‚ (Eden)      â”‚ (Survivor)  â”‚     â”‚ (Old)      â”‚
â”‚ 2MB         â”‚ 2MB         â”‚ 2MB         â”‚     â”‚ 2MB        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆå§‹çŠ¶æ€åˆ†é… (JVMå¯åŠ¨å):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŒºåŸŸç±»å‹      â”‚ æ•°é‡    â”‚ å¤§å°      â”‚ è¯´æ˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Free         â”‚ ~3800   â”‚ ~7.4GB    â”‚ ç©ºé—²åŒºåŸŸ               â”‚
â”‚ Eden         â”‚ ~200    â”‚ ~400MB    â”‚ æ–°ç”Ÿä»£Eden (5%åˆå§‹)    â”‚
â”‚ Survivor     â”‚ ~50     â”‚ ~100MB    â”‚ æ–°ç”Ÿä»£Survivor         â”‚
â”‚ Old          â”‚ ~40     â”‚ ~80MB     â”‚ è€å¹´ä»£ (ç³»ç»Ÿç±»ç­‰)      â”‚
â”‚ Humongous    â”‚ ~6      â”‚ ~12MB     â”‚ å·¨å‹å¯¹è±¡åŒºåŸŸ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ **7. æ€»ç»“**

### **7.1 æ ¸å¿ƒè¦ç‚¹**

1. **å•ä¾‹æ¨¡å¼å¹¿æ³›åº”ç”¨**: Universeã€VMThreadã€ServiceThreadç­‰æ ¸å¿ƒç»„ä»¶éƒ½æ˜¯å•ä¾‹
2. **åˆ†å±‚æ¶æ„**: å†…å­˜ç®¡ç†â†’çº¿ç¨‹ç®¡ç†â†’ç±»åŠ è½½â†’è¿è¡Œæ—¶æœåŠ¡ï¼Œå±‚å±‚ä¾èµ–
3. **å»¶è¿Ÿåˆå§‹åŒ–**: å¾ˆå¤šå¯¹è±¡åœ¨éœ€è¦æ—¶æ‰åˆ›å»ºï¼Œå¦‚nmethodã€ObjectMonitor
4. **é™æ€ç±»è®¾è®¡**: å¾ˆå¤šç®¡ç†å™¨ä½¿ç”¨AllStaticæ¨¡å¼ï¼Œé¿å…å®ä¾‹åŒ–å¼€é”€

### **7.2 å¯¹è±¡æ•°é‡æ¦‚è§ˆ**

| ç±»åˆ« | å¯¹è±¡æ•°é‡ | å†…å­˜å ç”¨ |
|------|---------|---------|
| **å•ä¾‹ç®¡ç†å™¨** | ~15ä¸ª | ~50KB |
| **å †åŒºåŸŸ** | ~4096ä¸ª | ~1MB |
| **ç±»å…ƒæ•°æ®** | ~1500ä¸ª | ~5MB |
| **æ–¹æ³•å…ƒæ•°æ®** | ~15000ä¸ª | ~3MB |
| **çº¿ç¨‹å¯¹è±¡** | ~15ä¸ª | ~100KB |
| **æ€»è®¡** | ~20000+ | ~10MB (ä¸å«å †) |

### **7.3 å­¦ä¹ å»ºè®®**

1. **å…ˆç†è§£Universe**: å®ƒæ˜¯æ‰€æœ‰å¯¹è±¡çš„å…¥å£ç‚¹
2. **æŒæ¡G1CollectedHeap**: ç†è§£å †çš„ç»„ç»‡æ–¹å¼
3. **ç†è§£çº¿ç¨‹æ¨¡å‹**: JavaThreadã€VMThreadçš„åä½œ
4. **æ·±å…¥ç±»åŠ è½½**: SystemDictionaryå’ŒClassLoaderDataçš„å…³ç³»
5. **æœ€åå­¦ä¹ GC**: å»ºç«‹åœ¨å‰é¢çŸ¥è¯†åŸºç¡€ä¸Š

é€šè¿‡æœ¬æ–‡æ¡£å’Œåç»­ä¸“é¢˜æ–‡æ¡£çš„å­¦ä¹ ï¼Œä½ å°†èƒ½å¤Ÿå®Œæ•´ç†è§£JVMå¯åŠ¨åçš„å†…éƒ¨ç»“æ„ï¼Œä¸ºæ·±å…¥å­¦ä¹ JVMæºç æ‰“ä¸‹åšå®åŸºç¡€ã€‚