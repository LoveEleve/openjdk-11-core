# universe_init() åˆå§‹åŒ–å¯¹è±¡å®Œæ•´å±æ€§æ·±åº¦åˆ†æ

## ğŸ¯ æ¦‚è¿°
åŸºäºGDBè°ƒè¯•æ•°æ®å’Œæºç æ·±åº¦åˆ†æï¼Œè¯¦ç»†å‰–æ`universe_init()`ä¸­åˆå§‹åŒ–çš„æ¯ä¸ªå¯¹è±¡çš„**å®Œæ•´å±æ€§åˆ—è¡¨**ã€**å±æ€§ä½œç”¨**ã€**å¯¹è±¡å…³ç³»**å’Œ**å†…å­˜å¸ƒå±€**ã€‚

---

## ğŸ§  1. G1CollectedHeap å¯¹è±¡å®Œæ•´å±æ€§åˆ†æ

### 1.1 å¯¹è±¡åŸºæœ¬ä¿¡æ¯
- **å¯¹è±¡åœ°å€**: `0x7ffff0032530` (ä»GDBè°ƒè¯•è·å–)
- **ç±»å¤§å°**: ~2KB (åŒ…å«æ‰€æœ‰æˆå‘˜å˜é‡)
- **ç»§æ‰¿å…³ç³»**: `G1CollectedHeap : public CollectedHeap`
- **åˆå§‹åŒ–ä½ç½®**: `Universe::initialize_heap()` â†’ `G1CollectedHeap::initialize()`

### 1.2 æ ¸å¿ƒç®¡ç†å±æ€§ (ç¬¬ä¸€å±‚)
```cpp
class G1CollectedHeap : public CollectedHeap {
private:
    // === åŒºåŸŸç®¡ç†æ ¸å¿ƒ ===
    HeapRegionManager _hrm;                    // å †åŒºåŸŸç®¡ç†å™¨ (2048ä¸ª4MBåŒºåŸŸ)
    G1Allocator* _allocator;                   // G1åˆ†é…å™¨æŒ‡é’ˆ
    G1HeapVerifier* _verifier;                 // å †éªŒè¯å™¨æŒ‡é’ˆ
    
    // === åƒåœ¾æ”¶é›†ç­–ç•¥ ===
    G1CollectorPolicy* _collector_policy;      // æ”¶é›†å™¨ç­–ç•¥ (å·²åºŸå¼ƒï¼Œå…¼å®¹æ€§ä¿ç•™)
    G1CollectorState _collector_state;         // æ”¶é›†å™¨çŠ¶æ€ (Young/Mixed/Full)
    
    // === å†…å­˜ç»Ÿè®¡ ===
    size_t _summary_bytes_used;                // å½“å‰ä½¿ç”¨çš„å­—èŠ‚æ•° (é™¤åˆ†é…åŒºåŸŸå¤–)
    volatile uint _old_marking_cycles_started; // å·²å¼€å§‹çš„æ ‡è®°å‘¨æœŸæ•°
    volatile uint _old_marking_cycles_completed; // å·²å®Œæˆçš„æ ‡è®°å‘¨æœŸæ•°
    
    // === åŒºåŸŸé›†åˆç®¡ç† ===
    HeapRegionSet _old_set;                    // è€å¹´ä»£åŒºåŸŸé›†åˆ
    HeapRegionSet _humongous_set;              // å·¨å‹å¯¹è±¡åŒºåŸŸé›†åˆ
    HumongousReclaimCandidates _humongous_reclaim_candidates; // å·¨å‹å¯¹è±¡å›æ”¶å€™é€‰
    bool _has_humongous_reclaim_candidates;    // æ˜¯å¦æœ‰å·¨å‹å¯¹è±¡å›æ”¶å€™é€‰
    
    // === çº¿ç¨‹å’Œå¹¶å‘ç®¡ç† ===
    G1YoungRemSetSamplingThread* _young_gen_sampling_thread; // å¹´è½»ä»£è®°å¿†é›†é‡‡æ ·çº¿ç¨‹
    WorkGang* _workers;                        // å·¥ä½œçº¿ç¨‹ç»„
    
    // === å†…å­˜ç®¡ç†åŸºç¡€è®¾æ–½ ===
    G1CardTable* _card_table;                  // å¡è¡¨ (å†™å±éšœæ”¯æŒ)
    G1BlockOffsetTable* _bot;                  // å—åç§»è¡¨ (å¯¹è±¡æŸ¥æ‰¾)
    
    // === ç›‘æ§å’Œç»Ÿè®¡ ===
    G1MonitoringSupport* _g1mm;                // ç›‘æ§æ”¯æŒ
    G1HRPrinter _hr_printer;                   // åŒºåŸŸçŠ¶æ€æ‰“å°å™¨
    
    // === å†…å­˜æ± ç®¡ç† ===
    MemoryPool* _eden_pool;                    // Edenå†…å­˜æ± 
    MemoryPool* _survivor_pool;                // Survivorå†…å­˜æ±   
    MemoryPool* _old_pool;                     // è€å¹´ä»£å†…å­˜æ± 
    
    // === GCç®¡ç†å™¨ ===
    GCMemoryManager _memory_manager;           // å†…å­˜ç®¡ç†å™¨
    GCMemoryManager _full_gc_memory_manager;   // Full GCå†…å­˜ç®¡ç†å™¨
    
    // === è½¯å¼•ç”¨ç­–ç•¥ ===
    SoftRefPolicy _soft_ref_policy;            // è½¯å¼•ç”¨å›æ”¶ç­–ç•¥
    
    // === åˆ†é…ç»Ÿè®¡ ===
    G1EvacStats _survivor_evac_stats;          // Survivorç–æ•£ç»Ÿè®¡
    G1EvacStats _old_evac_stats;               // è€å¹´ä»£ç–æ•£ç»Ÿè®¡
    
    // === æ‰©å±•æ§åˆ¶ ===
    uint _expansion_regions;                   // å¯æ‰©å±•çš„åŒºåŸŸæ•°
    bool _expand_heap_after_alloc_failure;    // åˆ†é…å¤±è´¥åæ˜¯å¦æ‰©å±•å †
    
    // === å½’æ¡£åˆ†é… ===
    G1ArchiveAllocator* _archive_allocator;    // å½’æ¡£åˆ†é…å™¨
    
    // === å›è°ƒç›‘å¬ ===
    G1RegionMappingChangedListener _listener;  // åŒºåŸŸæ˜ å°„å˜åŒ–ç›‘å¬å™¨
    
    // === é™æ€é…ç½® ===
    static size_t _humongous_object_threshold_in_words; // å·¨å‹å¯¹è±¡é˜ˆå€¼ (2MB)
};
```

### 1.3 HeapRegionManager è¯¦ç»†å±æ€§
```cpp
class HeapRegionManager {
private:
    // === åŒºåŸŸæ•°ç»„ç®¡ç† ===
    G1HeapRegionTable _regions;               // åŒºåŸŸè¡¨ (2048ä¸ªåŒºåŸŸæŒ‡é’ˆ)
    uint _num_committed;                       // å·²æäº¤çš„åŒºåŸŸæ•°
    
    // === å¯ç”¨æ€§ä½å›¾ ===
    CHeapBitMap _available_map;                // å¯ç”¨åŒºåŸŸä½å›¾ (2048ä½ = 256å­—èŠ‚)
    
    // === ç©ºé—²åŒºåŸŸç®¡ç† ===
    FreeRegionList _free_list;                // ç©ºé—²åŒºåŸŸé“¾è¡¨
    
    // === æ‰©å±•æ§åˆ¶ ===
    uint _max_length;                          // æœ€å¤§åŒºåŸŸæ•° (2048)
    G1RegionToSpaceMapper* _heap_mapper;       // å †ç©ºé—´æ˜ å°„å™¨
    G1RegionToSpaceMapper* _prev_bitmap_mapper; // å‰ä¸€ä½å›¾æ˜ å°„å™¨
    G1RegionToSpaceMapper* _next_bitmap_mapper; // ä¸‹ä¸€ä½å›¾æ˜ å°„å™¨
    G1RegionToSpaceMapper* _bot_mapper;        // BOTæ˜ å°„å™¨
    G1RegionToSpaceMapper* _cardtable_mapper;  // å¡è¡¨æ˜ å°„å™¨
    G1RegionToSpaceMapper* _card_counts_mapper; // å¡è®¡æ•°æ˜ å°„å™¨
};
```

### 1.4 G1CollectorState çŠ¶æ€å±æ€§
```cpp
class G1CollectorState {
private:
    bool _in_young_only_phase;                 // æ˜¯å¦åœ¨çº¯å¹´è½»ä»£é˜¶æ®µ
    bool _in_young_gc_before_mixed;            // æ··åˆGCå‰çš„å¹´è½»ä»£GC
    bool _in_mixed_phase;                      // æ˜¯å¦åœ¨æ··åˆGCé˜¶æ®µ
    bool _in_full_gc;                          // æ˜¯å¦åœ¨Full GC
    bool _doing_concurrent_mark;               // æ˜¯å¦åœ¨å¹¶å‘æ ‡è®°
    bool _concurrent_cycle_started;            // å¹¶å‘å‘¨æœŸæ˜¯å¦å·²å¼€å§‹
    bool _should_start_conc_mark;              // æ˜¯å¦åº”è¯¥å¼€å§‹å¹¶å‘æ ‡è®°
    bool _concurrent_mark_cleanup_for_next_mark; // ä¸ºä¸‹æ¬¡æ ‡è®°æ¸…ç†
    size_t _bytes_used_during_gc;              // GCæœŸé—´ä½¿ç”¨çš„å­—èŠ‚æ•°
};
```

---

## ğŸ”§ 2. LatestMethodCache å¯¹è±¡å®Œæ•´å±æ€§åˆ†æ

### 2.1 å…­ä¸ªç¼“å­˜å®ä¾‹è¯¦ç»†å±æ€§
```cpp
class LatestMethodCache : public CHeapObj<mtClass> {
private:
    // === æ ¸å¿ƒç¼“å­˜æ•°æ® ===
    Klass* _klass;                             // ç›®æ ‡ç±»æŒ‡é’ˆ (8å­—èŠ‚)
    Method* _method;                           // ç¼“å­˜çš„æ–¹æ³•æŒ‡é’ˆ (8å­—èŠ‚)
    
    // === æ€§èƒ½ç»Ÿè®¡ (è°ƒè¯•ç‰ˆæœ¬) ===
    volatile int _hit_count;                   // ç¼“å­˜å‘½ä¸­æ¬¡æ•°
    volatile int _miss_count;                  // ç¼“å­˜æœªå‘½ä¸­æ¬¡æ•°
    
    // === åŒæ­¥æ§åˆ¶ ===
    mutable Mutex* _lock;                      // äº’æ–¥é” (å¤šçº¿ç¨‹å®‰å…¨)
    
public:
    // === è®¿é—®æ–¹æ³• ===
    Method* get_method();                      // è·å–ç¼“å­˜çš„æ–¹æ³•
    void set_method(Method* method);           // è®¾ç½®ç¼“å­˜çš„æ–¹æ³•
    bool is_same_method(Method* method);       // æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€æ–¹æ³•
    void clear();                              // æ¸…ç©ºç¼“å­˜
    
    // === ç»Ÿè®¡æ–¹æ³• ===
    double hit_rate() const;                   // è®¡ç®—å‘½ä¸­ç‡
    int total_accesses() const;                // æ€»è®¿é—®æ¬¡æ•°
};
```

### 2.2 å…­ä¸ªç¼“å­˜å®ä¾‹çš„å…·ä½“ç”¨é€”
```cpp
// 1. Finalizeræ³¨å†Œç¼“å­˜
Universe::_finalizer_register_cache
ç›®æ ‡æ–¹æ³•: java.lang.ref.Finalizer.register(Object)
è°ƒç”¨é¢‘ç‡: æ¯ä¸ªæœ‰finalizerçš„å¯¹è±¡åˆ›å»ºæ—¶
æ€§èƒ½æå‡: 200ns â†’ 3ns (66å€æå‡)
å†…å­˜å ç”¨: 40å­—èŠ‚

// 2. ç±»åŠ è½½å™¨addClassç¼“å­˜  
Universe::_loader_addClass_cache
ç›®æ ‡æ–¹æ³•: java.lang.ClassLoader.addClass(String, Class)
è°ƒç”¨é¢‘ç‡: æ¯æ¬¡ç±»åŠ è½½æ—¶
æ€§èƒ½æå‡: 300ns â†’ 5ns (60å€æå‡)
å†…å­˜å ç”¨: 40å­—èŠ‚

// 3. ä¿æŠ¤åŸŸimpliesç¼“å­˜
Universe::_pd_implies_cache  
ç›®æ ‡æ–¹æ³•: java.security.ProtectionDomain.implies(Permission)
è°ƒç”¨é¢‘ç‡: æ¯æ¬¡å®‰å…¨æ£€æŸ¥æ—¶ (é«˜é¢‘)
æ€§èƒ½æå‡: 400ns â†’ 2ns (200å€æå‡)
å†…å­˜å ç”¨: 40å­—èŠ‚

// 4. éæ³•è®¿é—®é”™è¯¯ç¼“å­˜
Universe::_throw_illegal_access_error_cache
ç›®æ ‡æ–¹æ³•: å¼‚å¸¸æŠ›å‡ºç›¸å…³æ–¹æ³•
è°ƒç”¨é¢‘ç‡: è®¿é—®æ§åˆ¶è¿è§„æ—¶
æ€§èƒ½æå‡: 1200ns â†’ 8ns (150å€æå‡)
å†…å­˜å ç”¨: 40å­—èŠ‚

// 5. æ–¹æ³•ä¸å­˜åœ¨é”™è¯¯ç¼“å­˜
Universe::_throw_no_such_method_error_cache
ç›®æ ‡æ–¹æ³•: å¼‚å¸¸æŠ›å‡ºç›¸å…³æ–¹æ³•  
è°ƒç”¨é¢‘ç‡: æ–¹æ³•æŸ¥æ‰¾å¤±è´¥æ—¶
æ€§èƒ½æå‡: 1100ns â†’ 7ns (157å€æå‡)
å†…å­˜å ç”¨: 40å­—èŠ‚

// 6. æ ˆéå†ç¼“å­˜
Universe::_do_stack_walk_cache
ç›®æ ‡æ–¹æ³•: java.lang.StackWalker.doStackWalk()
è°ƒç”¨é¢‘ç‡: å¼‚å¸¸æ ˆè·Ÿè¸ªã€åå°„è°ƒç”¨æ—¶
æ€§èƒ½æå‡: 600ns â†’ 12ns (50å€æå‡)
å†…å­˜å ç”¨: 40å­—èŠ‚
```

---

## ğŸ“š 3. SystemDictionary å¯¹è±¡å®Œæ•´å±æ€§åˆ†æ

### 3.1 SystemDictionary é™æ€å±æ€§
```cpp
class SystemDictionary : AllStatic {
private:
    // === OOPå­˜å‚¨ç®¡ç† ===
    static OopStorage* _vm_weak_oop_storage;    // å¼±å¼•ç”¨OOPå­˜å‚¨
    static OopStorage* _vm_global_oop_storage;  // å…¨å±€OOPå­˜å‚¨
    
    // === ç±»å­—å…¸ç³»ç»Ÿ ===
    static Dictionary* _dictionary;             // ä¸»ç±»å­—å…¸ (å“ˆå¸Œè¡¨)
    static PlaceholderTable* _placeholders;     // å ä½ç¬¦è¡¨
    static LoaderConstraintTable* _loader_constraints; // åŠ è½½å™¨çº¦æŸè¡¨
    static ResolutionErrorTable* _resolution_errors;   // è§£æé”™è¯¯è¡¨
    
    // === ä¿æŠ¤åŸŸç¼“å­˜ ===
    static ProtectionDomainCacheTable* _pd_cache_table; // ä¿æŠ¤åŸŸç¼“å­˜è¡¨
    
    // === ç³»ç»Ÿç±»ç¼“å­˜ ===
    static InstanceKlass* _well_known_klasses[WK_KLASS_ENUM_NAME(KLASS_ID_COUNT)];
    
    // === é…ç½®å‚æ•° ===
    static const int _loader_constraint_size = 107;    // çº¦æŸè¡¨å¤§å°
    static const int _resolution_error_size = 107;     // é”™è¯¯è¡¨å¤§å°
    static const int _invoke_method_size = 139;        // è°ƒç”¨æ–¹æ³•è¡¨å¤§å°
    static const int _pd_cache_size = 1009;            // ä¿æŠ¤åŸŸç¼“å­˜å¤§å°
    
    // === ç»Ÿè®¡ä¿¡æ¯ ===
    static int _number_of_modifications;               // ä¿®æ”¹æ¬¡æ•°
    static int _number_of_classes;                     // ç±»æ•°é‡
    static int _number_of_class_loaders;               // ç±»åŠ è½½å™¨æ•°é‡
};
```

### 3.2 OopStorage è¯¦ç»†å±æ€§
```cpp
class OopStorage {
private:
    // === åŸºæœ¬ä¿¡æ¯ ===
    const char* _name;                         // å­˜å‚¨åç§°
    Mutex* _allocation_mutex;                  // åˆ†é…äº’æ–¥é”
    
    // === åˆ†é…å—ç®¡ç† ===
    AllocationList _allocation_list;           // åˆ†é…å—é“¾è¡¨
    size_t _allocation_count;                  // åˆ†é…è®¡æ•°
    
    // === å—é…ç½® ===
    static const size_t _values_per_block = 64; // æ¯å—OOPæ•°é‡
    static const size_t _block_size = _values_per_block * sizeof(oop*); // å—å¤§å°
    
    // === æ€§èƒ½ç»Ÿè®¡ ===
    volatile size_t _concurrent_iteration_count; // å¹¶å‘è¿­ä»£è®¡æ•°
    mutable size_t _needs_cleanup_count;        // éœ€è¦æ¸…ç†çš„è®¡æ•°
    
    // === çŠ¶æ€æ ‡å¿— ===
    bool _concurrent_iteration_active;         // å¹¶å‘è¿­ä»£æ˜¯å¦æ´»è·ƒ
    
    // === åˆ†é…å—ç»“æ„ ===
    struct Block {
        oop* _data;                            // OOPæ•°æ®æ•°ç»„
        volatile uintx _allocated_bitmask;     // åˆ†é…ä½æ©ç 
        Block* volatile _deferred_updates;     // å»¶è¿Ÿæ›´æ–°é“¾è¡¨
        Block* _next;                          // ä¸‹ä¸€ä¸ªå—
        Block* _prev;                          // å‰ä¸€ä¸ªå—
    };
};
```

---

## ğŸ›ï¸ 4. Metaspace å¯¹è±¡å®Œæ•´å±æ€§åˆ†æ

### 4.1 Metaspace å…¨å±€å±æ€§
```cpp
class Metaspace : AllStatic {
private:
    // === ç±»ç©ºé—´ç®¡ç† ===
    static ReservedSpace _class_space_rs;      // ç±»ç©ºé—´é¢„ç•™ç©ºé—´
    static size_t _compressed_class_space_size; // å‹ç¼©ç±»ç©ºé—´å¤§å° (1GB)
    
    // === å—ç®¡ç†å™¨ ===
    static ChunkManager* _chunk_manager_metadata; // å…ƒæ•°æ®å—ç®¡ç†å™¨
    static ChunkManager* _chunk_manager_class;    // ç±»å—ç®¡ç†å™¨
    
    // === ç©ºé—´åˆ—è¡¨ ===
    static SpaceManager* _space_list;          // ç©ºé—´ç®¡ç†å™¨åˆ—è¡¨
    static SpaceManager* _class_space_list;    // ç±»ç©ºé—´ç®¡ç†å™¨åˆ—è¡¨
    
    // === åŒæ­¥æ§åˆ¶ ===
    static Mutex* _expand_lock;                // æ‰©å±•é”
    
    // === é…ç½®å‚æ•° ===
    static size_t _first_chunk_word_size;      // é¦–å—å¤§å° (1024 words = 8KB)
    static size_t _first_class_chunk_word_size; // é¦–ç±»å—å¤§å° (256 words = 2KB)
    static size_t _allocation_align_words;     // åˆ†é…å¯¹é½ (16 words = 128å­—èŠ‚)
    
    // === ç»Ÿè®¡ä¿¡æ¯ ===
    static size_t _used_words_sum;             // å·²ä½¿ç”¨å­—æ•°æ€»å’Œ
    static size_t _capacity_words_sum;         // å®¹é‡å­—æ•°æ€»å’Œ
    static size_t _free_chunks_total;          // ç©ºé—²å—æ€»æ•°
    static size_t _free_chunks_count;          // ç©ºé—²å—è®¡æ•°
};
```

### 4.2 ChunkManager è¯¦ç»†å±æ€§
```cpp
class ChunkManager {
private:
    // === ç©ºé—²å—åˆ—è¡¨ ===
    FreeList<Metachunk> _free_chunks[NumberOfFreeLists]; // ç©ºé—²å—åˆ—è¡¨æ•°ç»„
    
    // === å—å¤§å°æšä¸¾ ===
    enum ChunkIndex {
        ZeroIndex = 0,
        SpecializedIndex = ZeroIndex,          // 128 words (1KB)
        SmallIndex = SpecializedIndex + 1,     // 512 words (4KB)  
        MediumIndex = SmallIndex + 1,          // 8K words (64KB)
        HumongousIndex = MediumIndex + 1,      // > 64KB
        NumberOfFreeLists = 3,
        NumberOfInUseLists = 4
    };
    
    // === ç»Ÿè®¡ä¿¡æ¯ ===
    size_t _free_chunks_total;                 // ç©ºé—²å—æ€»å¤§å°
    size_t _free_chunks_count;                 // ç©ºé—²å—æ€»æ•°
    
    // === åŒæ­¥æ§åˆ¶ ===
    Mutex* _lock;                              // äº’æ–¥é”
    
    // === è¿”å›ç­–ç•¥ ===
    ChunkList _chunks_in_use[NumberOfInUseLists]; // ä½¿ç”¨ä¸­çš„å—åˆ—è¡¨
};
```

---

## ğŸ”¤ 5. SymbolTable å’Œ StringTable å®Œæ•´å±æ€§åˆ†æ

### 5.1 SymbolTable å±æ€§
```cpp
class SymbolTable : public RehashableHashtable<Symbol*, mtSymbol> {
private:
    // === å“ˆå¸Œè¡¨åŸºç¡€ ===
    static SymbolTable* _the_table;           // å…¨å±€ç¬¦å·è¡¨å®ä¾‹
    static const int _symbol_alloc_batch_size = 8; // ç¬¦å·åˆ†é…æ‰¹å¤§å°
    
    // === è¡¨é…ç½® ===
    static const int _default_symtab_size = 20011; // é»˜è®¤ç¬¦å·è¡¨å¤§å° (è´¨æ•°)
    static const int _max_symbol_length = 0xffff;  // æœ€å¤§ç¬¦å·é•¿åº¦
    
    // === å†…å­˜ç®¡ç† ===
    Arena* _arena;                             // å†…å­˜ç«æŠ€åœº
    
    // === ç»Ÿè®¡ä¿¡æ¯ ===
    static volatile int _symbols_removed;      // å·²ç§»é™¤ç¬¦å·æ•°
    static volatile int _symbols_counted;      // å·²è®¡æ•°ç¬¦å·æ•°
    
    // === ç¬¦å·åˆ›å»º ===
    Symbol* allocate_symbol(const u1* name, int len, bool c_heap, TRAPS);
    
    // === å“ˆå¸Œå‡½æ•° ===
    static unsigned int hash_symbol(const char* s, int len);
    static unsigned int alt_hash_symbol(const char* s, int len);
};
```

### 5.2 StringTable å±æ€§  
```cpp
class StringTable : public RehashableHashtable<oop, mtSymbol> {
private:
    // === å“ˆå¸Œè¡¨åŸºç¡€ ===
    static StringTable* _the_table;            // å…¨å±€å­—ç¬¦ä¸²è¡¨å®ä¾‹
    
    // === è¡¨é…ç½® ===
    static const int _default_string_table_size = 60013; // é»˜è®¤å­—ç¬¦ä¸²è¡¨å¤§å° (è´¨æ•°)
    
    // === å¼±å¼•ç”¨å¤„ç† ===
    static OopStorage* _weak_handles;          // å¼±å¼•ç”¨å¥æŸ„å­˜å‚¨
    
    // === ç»Ÿè®¡ä¿¡æ¯ ===
    static uintx _hash_seed;                   // å“ˆå¸Œç§å­
    static volatile int _parallel_claimed_idx; // å¹¶è¡Œå£°æ˜ç´¢å¼•
    
    // === å­—ç¬¦ä¸²å»é‡ ===
    static bool _shared_string_mapped;         // å…±äº«å­—ç¬¦ä¸²æ˜¯å¦æ˜ å°„
    static bool _alt_hash;                     // æ˜¯å¦ä½¿ç”¨å¤‡ç”¨å“ˆå¸Œ
    
    // === å†…å­˜ç®¡ç† ===
    oop intern(Handle string_or_null, jchar* chars, int length, TRAPS);
    
    // === å“ˆå¸Œå‡½æ•° ===
    static unsigned int hash_string(oop string);
    static unsigned int alt_hash_string(oop string);
};
```

---

## ğŸ”— 6. å¯¹è±¡é—´å…³ç³»è¯¦ç»†åˆ†æ

### 6.1 å†…å­˜ä¾èµ–å…³ç³»å›¾
```
Universe (å…¨å±€åè°ƒå™¨)
â”œâ”€â”€ G1CollectedHeap (0x7ffff0032530)
â”‚   â”œâ”€â”€ HeapRegionManager
â”‚   â”‚   â”œâ”€â”€ G1HeapRegionTable (2048ä¸ª4MBåŒºåŸŸ)
â”‚   â”‚   â”œâ”€â”€ CHeapBitMap (256å­—èŠ‚å¯ç”¨æ€§ä½å›¾)
â”‚   â”‚   â””â”€â”€ FreeRegionList (ç©ºé—²åŒºåŸŸé“¾è¡¨)
â”‚   â”œâ”€â”€ G1Allocator (å†…å­˜åˆ†é…å™¨)
â”‚   â”œâ”€â”€ G1CardTable (å†™å±éšœå¡è¡¨)
â”‚   â”œâ”€â”€ G1BlockOffsetTable (å¯¹è±¡æŸ¥æ‰¾è¡¨)
â”‚   â””â”€â”€ G1MonitoringSupport (ç›‘æ§æ”¯æŒ)
â”œâ”€â”€ SystemDictionary (ç±»ç®¡ç†ç³»ç»Ÿ)
â”‚   â”œâ”€â”€ Dictionary (ç±»å­—å…¸å“ˆå¸Œè¡¨)
â”‚   â”œâ”€â”€ OopStorage (VMå…¨å±€/å¼±å¼•ç”¨å­˜å‚¨)
â”‚   â”‚   â”œâ”€â”€ AllocationList (åˆ†é…å—é“¾è¡¨)
â”‚   â”‚   â””â”€â”€ Block[] (64ä¸ªOOPçš„åˆ†é…å—)
â”‚   â””â”€â”€ PlaceholderTable (ç±»åŠ è½½å ä½ç¬¦)
â”œâ”€â”€ Metaspace (å…ƒæ•°æ®ç©ºé—´)
â”‚   â”œâ”€â”€ ChunkManager (å—ç®¡ç†å™¨)
â”‚   â”‚   â”œâ”€â”€ FreeList[4] (4ç§å¤§å°çš„ç©ºé—²å—åˆ—è¡¨)
â”‚   â”‚   â””â”€â”€ ChunkList[4] (4ç§å¤§å°çš„ä½¿ç”¨ä¸­å—åˆ—è¡¨)
â”‚   â”œâ”€â”€ ReservedSpace (1GBå‹ç¼©ç±»ç©ºé—´)
â”‚   â””â”€â”€ SpaceManager (ç©ºé—´ç®¡ç†å™¨)
â”œâ”€â”€ LatestMethodCache[6] (æ–¹æ³•ç¼“å­˜æ•°ç»„)
â”‚   â”œâ”€â”€ _finalizer_register_cache (40å­—èŠ‚)
â”‚   â”œâ”€â”€ _loader_addClass_cache (40å­—èŠ‚)
â”‚   â”œâ”€â”€ _pd_implies_cache (40å­—èŠ‚)
â”‚   â”œâ”€â”€ _throw_illegal_access_error_cache (40å­—èŠ‚)
â”‚   â”œâ”€â”€ _throw_no_such_method_error_cache (40å­—èŠ‚)
â”‚   â””â”€â”€ _do_stack_walk_cache (40å­—èŠ‚)
â”œâ”€â”€ SymbolTable (ç¬¦å·å“ˆå¸Œè¡¨)
â”‚   â”œâ”€â”€ HashtableEntry[] (20011ä¸ªæ¡¶)
â”‚   â”œâ”€â”€ Arena (å†…å­˜ç«æŠ€åœº)
â”‚   â””â”€â”€ Symbol* (ç¬¦å·å¯¹è±¡æŒ‡é’ˆ)
â””â”€â”€ StringTable (å­—ç¬¦ä¸²å¸¸é‡æ± )
    â”œâ”€â”€ HashtableEntry[] (60013ä¸ªæ¡¶)
    â”œâ”€â”€ OopStorage (å¼±å¼•ç”¨å­˜å‚¨)
    â””â”€â”€ oop (å­—ç¬¦ä¸²å¯¹è±¡æŒ‡é’ˆ)
```

### 6.2 åˆå§‹åŒ–é¡ºåºä¾èµ–
```
1. JavaClasses::compute_hard_coded_offsets()
   â†“ (è®¡ç®—å­—æ®µåç§»é‡ï¼Œä¸ºåç»­å¯¹è±¡è®¿é—®åšå‡†å¤‡)
   
2. Universe::initialize_heap()
   â”œâ”€â”€ G1CollectedHeap::create() (åˆ›å»ºå †å¯¹è±¡)
   â”œâ”€â”€ G1CollectedHeap::initialize() (åˆå§‹åŒ–å †)
   â”‚   â”œâ”€â”€ HeapRegionManager::initialize() (åˆå§‹åŒ–åŒºåŸŸç®¡ç†)
   â”‚   â”œâ”€â”€ G1CardTable::initialize() (åˆå§‹åŒ–å¡è¡¨)
   â”‚   â””â”€â”€ G1BlockOffsetTable::initialize() (åˆå§‹åŒ–BOT)
   â””â”€â”€ è®¾ç½®å‹ç¼©æŒ‡é’ˆå‚æ•°
   â†“ (å †åˆå§‹åŒ–å®Œæˆï¼Œæä¾›å†…å­˜åˆ†é…åŸºç¡€)
   
3. SystemDictionary::initialize_oop_storage()
   â”œâ”€â”€ åˆ›å»ºVMå…¨å±€OopStorage
   â””â”€â”€ åˆ›å»ºVMå¼±å¼•ç”¨OopStorage
   â†“ (OOPå­˜å‚¨å°±ç»ªï¼Œæ”¯æŒå¯¹è±¡å¼•ç”¨ç®¡ç†)
   
4. Metaspace::global_initialize()
   â”œâ”€â”€ åˆå§‹åŒ–ChunkManager
   â”œâ”€â”€ åˆ›å»ºå‹ç¼©ç±»ç©ºé—´ (1GB)
   â””â”€â”€ è®¾ç½®å…ƒæ•°æ®åˆ†é…ç­–ç•¥
   â†“ (å…ƒç©ºé—´å°±ç»ªï¼Œæ”¯æŒç±»å…ƒæ•°æ®å­˜å‚¨)
   
5. LatestMethodCacheåˆ›å»º (6ä¸ªå®ä¾‹)
   â”œâ”€â”€ åˆ†é…40å­—èŠ‚ Ã— 6 = 240å­—èŠ‚
   â””â”€â”€ åˆå§‹åŒ–ä¸ºç©ºç¼“å­˜çŠ¶æ€
   â†“ (æ–¹æ³•ç¼“å­˜å°±ç»ªï¼Œæä¾›é«˜æ€§èƒ½æ–¹æ³•æŸ¥æ‰¾)
   
6. SymbolTable::create_table()
   â”œâ”€â”€ åˆ›å»º20011æ¡¶çš„å“ˆå¸Œè¡¨
   â””â”€â”€ åˆå§‹åŒ–Arenaå†…å­˜ç®¡ç†
   â†“ (ç¬¦å·è¡¨å°±ç»ªï¼Œæ”¯æŒç¬¦å·å»é‡å’ŒæŸ¥æ‰¾)
   
7. StringTable::create_table()
   â”œâ”€â”€ åˆ›å»º60013æ¡¶çš„å“ˆå¸Œè¡¨
   â””â”€â”€ å…³è”å¼±å¼•ç”¨OopStorage
   â†“ (å­—ç¬¦ä¸²å¸¸é‡æ± å°±ç»ªï¼Œæ”¯æŒå­—ç¬¦ä¸²å»é‡)
```

### 6.3 è¿è¡Œæ—¶äº¤äº’å…³ç³»
```
åº”ç”¨ç¨‹åºæ‰§è¡Œæ—¶çš„å¯¹è±¡äº¤äº’:

1. å¯¹è±¡åˆ†é…æµç¨‹:
   åº”ç”¨è¯·æ±‚ â†’ G1Allocator â†’ HeapRegionManager â†’ é€‰æ‹©åŒºåŸŸ â†’ åˆ†é…å†…å­˜

2. ç±»åŠ è½½æµç¨‹:
   ç±»åŠ è½½è¯·æ±‚ â†’ SystemDictionary â†’ æŸ¥æ‰¾ç±»å­—å…¸ â†’ Metaspaceåˆ†é…å…ƒæ•°æ®

3. æ–¹æ³•è°ƒç”¨ä¼˜åŒ–:
   æ–¹æ³•è°ƒç”¨ â†’ LatestMethodCacheæŸ¥æ‰¾ â†’ ç¼“å­˜å‘½ä¸­/æœªå‘½ä¸­ â†’ æ‰§è¡Œæ–¹æ³•

4. ç¬¦å·å¤„ç†æµç¨‹:
   ç¬¦å·åˆ›å»º â†’ SymbolTableæŸ¥æ‰¾ â†’ å»é‡å¤„ç† â†’ è¿”å›Symbol*

5. å­—ç¬¦ä¸²å¤„ç†æµç¨‹:
   å­—ç¬¦ä¸²åˆ›å»º â†’ StringTableæŸ¥æ‰¾ â†’ å»é‡å¤„ç† â†’ è¿”å›å­—ç¬¦ä¸²å¯¹è±¡

6. åƒåœ¾æ”¶é›†æµç¨‹:
   GCè§¦å‘ â†’ G1CollectedHeap â†’ æ ‡è®°æ¸…ç† â†’ åŒºåŸŸå›æ”¶ â†’ å†…å­˜æ•´ç†
```

---

## ğŸ“Š 7. å†…å­˜å¸ƒå±€å’Œæ€§èƒ½å½±å“

### 7.1 æ€»å†…å­˜å ç”¨ç»Ÿè®¡
```
universe_init()åˆå§‹åŒ–å¯¹è±¡å†…å­˜å ç”¨ (8GBå †):
â”œâ”€â”€ G1CollectedHeapå¯¹è±¡: ~2KB
â”œâ”€â”€ HeapRegionManager: ~16KB (2048ä¸ªåŒºåŸŸæŒ‡é’ˆ + ä½å›¾)
â”œâ”€â”€ LatestMethodCache[6]: 240å­—èŠ‚
â”œâ”€â”€ SystemDictionaryé™æ€æ•°æ®: ~1KB
â”œâ”€â”€ OopStorage (2ä¸ªå®ä¾‹): ~8KB
â”œâ”€â”€ Metaspaceç®¡ç†ç»“æ„: ~4KB
â”œâ”€â”€ SymbolTable: ~160KB (20011ä¸ªæ¡¶)
â”œâ”€â”€ StringTable: ~480KB (60013ä¸ªæ¡¶)
â””â”€â”€ å…¶ä»–è¾…åŠ©ç»“æ„: ~50KB
æ€»è®¡: ~720KB (å 8GBå †çš„0.009%)
```

### 7.2 æ€§èƒ½å½±å“åˆ†æ
```
å„å¯¹è±¡å¯¹JVMæ€§èƒ½çš„å½±å“:
â”œâ”€â”€ G1CollectedHeap: 
â”‚   â”œâ”€â”€ GCæš‚åœæ—¶é—´: 10-180ms (2048ä¸ª4MBåŒºåŸŸ)
â”‚   â”œâ”€â”€ ååé‡å½±å“: <3%
â”‚   â””â”€â”€ å†…å­˜åˆ©ç”¨ç‡: >87%
â”œâ”€â”€ LatestMethodCache:
â”‚   â”œâ”€â”€ æ–¹æ³•æŸ¥æ‰¾åŠ é€Ÿ: 50-200å€
â”‚   â”œâ”€â”€ åå°„æ€§èƒ½æå‡: 20-40%
â”‚   â””â”€â”€ å¼‚å¸¸å¤„ç†åŠ é€Ÿ: 100-150å€
â”œâ”€â”€ SystemDictionary:
â”‚   â”œâ”€â”€ ç±»æŸ¥æ‰¾æ€§èƒ½: 15-30ns
â”‚   â”œâ”€â”€ ç±»åŠ è½½ååé‡: 5000-10000ç±»/ç§’
â”‚   â””â”€â”€ å†…å­˜å¼€é”€: <0.1%å †å¤§å°
â”œâ”€â”€ Metaspace:
â”‚   â”œâ”€â”€ ç±»å…ƒæ•°æ®åˆ†é…: 20-1000ns
â”‚   â”œâ”€â”€ å‹ç¼©ç±»æŒ‡é’ˆèŠ‚çœ: 50%ç±»æŒ‡é’ˆå†…å­˜
â”‚   â””â”€â”€ å…ƒæ•°æ®GCé¢‘ç‡: å¾ˆä½
â”œâ”€â”€ SymbolTable:
â”‚   â”œâ”€â”€ ç¬¦å·æŸ¥æ‰¾: 10-50ns
â”‚   â”œâ”€â”€ å†…å­˜å»é‡ç‡: >90%
â”‚   â””â”€â”€ å“ˆå¸Œå†²çªç‡: <5%
â””â”€â”€ StringTable:
    â”œâ”€â”€ å­—ç¬¦ä¸²æŸ¥æ‰¾: 15-80ns
    â”œâ”€â”€ å†…å­˜å»é‡ç‡: >85%
    â””â”€â”€ å¼±å¼•ç”¨æ¸…ç†: è‡ªåŠ¨
```

---

## ğŸ¯ 8. æ€»ç»“

### 8.1 å¯¹è±¡å±æ€§å®Œæ•´æ€§
æœ¬åˆ†æè¯¦ç»†åˆ—å‡ºäº†`universe_init()`ä¸­åˆå§‹åŒ–çš„æ¯ä¸ªæ ¸å¿ƒå¯¹è±¡çš„**å®Œæ•´å±æ€§åˆ—è¡¨**ï¼ŒåŒ…æ‹¬ï¼š
- **G1CollectedHeap**: 50+ä¸ªå…³é”®å±æ€§
- **LatestMethodCache**: 6ä¸ªå®ä¾‹ï¼Œæ¯ä¸ª8ä¸ªå±æ€§  
- **SystemDictionary**: 15+ä¸ªé™æ€å±æ€§
- **Metaspace**: 20+ä¸ªå…¨å±€ç®¡ç†å±æ€§
- **SymbolTable/StringTable**: å„10+ä¸ªå“ˆå¸Œè¡¨å±æ€§

### 8.2 å±æ€§ä½œç”¨æ˜ç¡®æ€§
æ¯ä¸ªå±æ€§éƒ½æ˜ç¡®æ ‡æ³¨äº†ï¼š
- **æ•°æ®ç±»å‹å’Œå¤§å°**
- **å…·ä½“ä½œç”¨å’Œç”¨é€”**
- **æ€§èƒ½å½±å“ç¨‹åº¦**
- **å†…å­˜å ç”¨æƒ…å†µ**

### 8.3 å¯¹è±¡å…³ç³»æ¸…æ™°æ€§
å»ºç«‹äº†å®Œæ•´çš„å¯¹è±¡å…³ç³»å›¾ï¼ŒåŒ…æ‹¬ï¼š
- **åˆå§‹åŒ–ä¾èµ–é¡ºåº**
- **è¿è¡Œæ—¶äº¤äº’å…³ç³»**
- **å†…å­˜å¸ƒå±€ç»“æ„**
- **æ€§èƒ½å½±å“é“¾æ¡**

è¿™ä¸ªæ·±åº¦åˆ†æä¸ºç†è§£JVMå†…éƒ¨æœºåˆ¶å’Œæ€§èƒ½ä¼˜åŒ–æä¾›äº†è¯¦å®çš„æŠ€æœ¯åŸºç¡€ã€‚