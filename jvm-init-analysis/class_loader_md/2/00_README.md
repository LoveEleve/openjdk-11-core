# JVMç±»åŠ è½½åŸç†æ·±åº¦åˆ†æ - è§£é‡Šæ¨¡å¼GDBéªŒè¯

> **éªŒè¯ç¯å¢ƒ**: OpenJDK 11 slowdebug  
> **JVMå‚æ•°**: `-Xms8g -Xmx8g -XX:+UseG1GC -XX:-UseLargePages -Xint`  
> **ç›®æ ‡ç±»**: HelloWorld  
> **éªŒè¯æ—¶é—´**: 2026-01-15

---

## ğŸ“š æ–‡æ¡£ç›®å½•

| æ–‡æ¡£ | å†…å®¹ |
|------|------|
| [01_ç±»åŠ è½½å®Œæ•´æµç¨‹_è§£é‡Šæ¨¡å¼éªŒè¯.md](./01_ç±»åŠ è½½å®Œæ•´æµç¨‹_è§£é‡Šæ¨¡å¼éªŒè¯.md) | ç±»åŠ è½½ä¸‰é˜¶æ®µã€è°ƒç”¨æ ˆã€åŒäº²å§”æ´¾ |
| [02_InstanceKlassæ•°æ®ç»“æ„_8GBå †éªŒè¯.md](./02_InstanceKlassæ•°æ®ç»“æ„_8GBå †éªŒè¯.md) | InstanceKlasså†…å­˜å¸ƒå±€ã€vtableã€å¸¸é‡æ±  |
| [03_å­—èŠ‚ç è§£é‡Šæ‰§è¡Œ_Xintæ¨¡å¼.md](./03_å­—èŠ‚ç è§£é‡Šæ‰§è¡Œ_Xintæ¨¡å¼.md) | å­—èŠ‚ç é‡å†™ã€è§£é‡Šå™¨å…¥å£ã€æ‰§è¡Œæµç¨‹ |

---

## ğŸ”¬ æ ¸å¿ƒéªŒè¯æ•°æ®

### HelloWorldç±»å­˜å‚¨ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­˜å‚¨åŒºåŸŸ                    â”‚ åœ°å€                â”‚ å¤§å°           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ InstanceKlass              â”‚ 0x800092840        â”‚ 472 bytes      â”‚
â”‚ (Compressed Class Space)   â”‚                    â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ConstantPool               â”‚ 0x7fffcefa6068     â”‚ ~232 bytes     â”‚
â”‚ (Metaspace Non-class)      â”‚ 29é¡¹               â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CPCache                    â”‚ 0x7fffcefa6348     â”‚ ~96 bytes      â”‚
â”‚ (Metaspace Non-class)      â”‚ 3é¡¹                â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Method (main)              â”‚ 0x7fffcefa62e0     â”‚ ~48 bytes      â”‚
â”‚ (Metaspace Non-class)      â”‚                    â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ConstMethod (main)         â”‚ 0x7fffcefa6298     â”‚ ~72 bytes      â”‚
â”‚ (å«9å­—èŠ‚å­—èŠ‚ç )             â”‚                    â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è§£é‡Šå™¨å…¥å£                  â”‚ 0x7fffed010c00     â”‚ (CodeCache)    â”‚
â”‚ (_i2i_entry)               â”‚                    â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### InstanceKlasså…³é”®å­—æ®µ

| å­—æ®µ | å€¼ | è¯´æ˜ |
|------|-----|------|
| `_name` | 0x7ffff0f65af0 | Symbol "HelloWorld" |
| `_super` | 0x800001040 | java/lang/Object |
| `_vtable_len` | 5 | ç»§æ‰¿è‡ªObjectçš„è™šæ–¹æ³• |
| `_itable_len` | 2 | æ¥å£è¡¨ |
| `_constants` | 0x7fffcefa6068 | ConstantPool |
| `_methods->_length` | 2 | `<init>` + `main` |
| `_init_state` | 6 | fully_initialized |

### mainæ–¹æ³•è¯¦æƒ…

| å±æ€§ | å€¼ |
|------|-----|
| Method* | 0x7fffcefa62e0 |
| ConstMethod* | 0x7fffcefa6298 |
| code_size | 9 bytes |
| max_stack | 2 |
| max_locals | 1 |
| è§£é‡Šå™¨å…¥å£ | 0x7fffed010c00 |

### mainæ–¹æ³•å­—èŠ‚ç 

```
åŸå§‹å­—èŠ‚ç :
b2 00 02   getstatic #2      // System.out
12 03      ldc #3            // "Hello World"
b6 00 04   invokevirtual #4  // println
b1         return

é‡å†™å:
b2 01 00   getstatic (CPCacheç´¢å¼•)
e6 00      fast_aldc
b6 02 00   invokevirtual (CPCacheç´¢å¼•)
b1         return
```

### vtable (åˆå§‹åŒ–å)

```
vtable[0]: 0x7fffceaf1f48 â†’ finalize()
vtable[1]: 0x7fffceaf18b8 â†’ equals()
vtable[2]: 0x7fffceaf1a68 â†’ toString()
vtable[3]: 0x7fffceaf17c0 â†’ hashCode()
vtable[4]: 0x7fffceaf1968 â†’ clone()
```

---

## ğŸ“Š ç±»åŠ è½½æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HelloWorld ç±»åŠ è½½å®Œæ•´æµç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚  â”‚ Class.forName()â”‚                                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ SystemDictionary::resolve_or_null      â”‚ â† åŒäº²å§”æ´¾å…¥å£            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ Bootstrap ClassLoaderå°è¯•åŠ è½½ â†’ å¤±è´¥    â”‚                         â”‚
â”‚  â”‚ â†“                                      â”‚                         â”‚
â”‚  â”‚ AppClassLoader.defineClass()           â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ KlassFactory::create_from_stream       â”‚ è§£æclassæ–‡ä»¶            â”‚
â”‚  â”‚ ClassFileParser::parse_stream          â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ InstanceKlass::link_class_impl         â”‚ é“¾æ¥é˜¶æ®µ                 â”‚
â”‚  â”‚ - éªŒè¯å­—èŠ‚ç                             â”‚                         â”‚
â”‚  â”‚ - åˆ›å»ºCPCache                          â”‚                         â”‚
â”‚  â”‚ - é‡å†™å­—èŠ‚ç                             â”‚                         â”‚
â”‚  â”‚ - å¡«å……vtable                           â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ InstanceKlass::initialize_impl         â”‚ åˆå§‹åŒ–é˜¶æ®µ               â”‚
â”‚  â”‚ _init_state = 6 (fully_initialized)   â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ ç±»åŠ è½½å®Œæˆï¼Œå¯è°ƒç”¨mainæ–¹æ³•              â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ GDBéªŒè¯å‘½ä»¤

### åŸºæœ¬è°ƒè¯•

```bash
# è¿›å…¥è°ƒè¯•æ¨¡å¼
cd /data/workspace/openjdk11-core/build/linux-x86_64-normal-server-slowdebug/jdk/bin
gdb ./java

# è®¾ç½®æ–­ç‚¹
break InstanceKlass::link_class_impl
break InstanceKlass::initialize_impl

# è¿è¡Œ (è§£é‡Šæ¨¡å¼)
run -Xms8g -Xmx8g -XX:+UseG1GC -XX:-UseLargePages -Xint -cp /data/workspace HelloWorld
```

### æŸ¥çœ‹InstanceKlass

```gdb
# æ‰“å°InstanceKlassåœ°å€
print this
# $1 = (InstanceKlass *) 0x800092840

# æŸ¥çœ‹å­—æ®µ
print this->_vtable_len
print this->_methods->_length
print this->_constants->_length

# æŸ¥çœ‹vtable
set $vtable = (intptr_t*)((char*)this + sizeof(InstanceKlass))
print (Method*)$vtable[0]
```

### æŸ¥çœ‹Method

```gdb
# è·å–mainæ–¹æ³•
set $method = (Method*)(this->_methods->_data[1])
print $method
print $method->_constMethod

# æŸ¥çœ‹å­—èŠ‚ç 
set $cm = $method->_constMethod
set $bc = (unsigned char*)((char*)$cm + sizeof(ConstMethod))
x/9bx $bc
```

---

## ğŸ’¡ æ ¸å¿ƒç»“è®º

### 1. ç±»åŠ è½½å­˜å‚¨ä½ç½®

- **InstanceKlass**: Compressed Class Space (0x800000000èµ·å§‹)
- **ConstantPool/Method**: Metaspace Non-classåŒºåŸŸ
- **è§£é‡Šå™¨æ¨¡æ¿**: CodeCache non-nmethodsåŒºåŸŸ

### 2. å­—èŠ‚ç é‡å†™

Linké˜¶æ®µä¼šé‡å†™å­—èŠ‚ç ï¼Œå°†å¸¸é‡æ± ç´¢å¼•æ›¿æ¢ä¸ºCPCacheç´¢å¼•ï¼š
- `getstatic #2` â†’ `getstatic (CPCache[0])`
- `ldc #3` â†’ `fast_aldc`
- `invokevirtual #4` â†’ `invokevirtual (CPCache[1])`

### 3. è§£é‡Šå™¨å…¥å£

è§£é‡Šæ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰æ–¹æ³•ä½¿ç”¨åŒä¸€ä¸ªè§£é‡Šå™¨å…¥å£:
- `_i2i_entry = _from_interpreted_entry = 0x7fffed010c00`
- è¿™æ˜¯TemplateInterpreterç”Ÿæˆçš„æ¨¡æ¿stub

### 4. vtableå¡«å……

åˆå§‹åŒ–åvtableæ‰å¡«å……å®Œæˆï¼ŒåŒ…å«ç»§æ‰¿è‡ªObjectçš„5ä¸ªè™šæ–¹æ³•:
- finalize, equals, toString, hashCode, clone

### 5. ç±»å…ƒæ•°æ®å¤§å°

HelloWorldç±»æ€»å…±å ç”¨çº¦ **1.1 KB** Metaspace:
- InstanceKlass: 472 bytes + vtable/itable
- ConstantPool: ~232 bytes
- CPCache: ~96 bytes
- Methods: ~168 bytes

---

## ğŸ“ ç›¸å…³æºç 

| åŠŸèƒ½ | æºæ–‡ä»¶ |
|------|--------|
| ç±»åŠ è½½å…¥å£ | `systemDictionary.cpp` |
| Classæ–‡ä»¶è§£æ | `classFileParser.cpp` |
| Klassåˆ›å»º | `klassFactory.cpp` |
| ç±»é“¾æ¥ | `instanceKlass.cpp` |
| å­—èŠ‚ç é‡å†™ | `rewriter.cpp` |
| è§£é‡Šå™¨ç”Ÿæˆ | `templateInterpreterGenerator_x86.cpp` |
| CPCache | `cpCache.cpp` |
