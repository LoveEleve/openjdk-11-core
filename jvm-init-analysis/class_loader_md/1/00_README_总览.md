# JVMç±»åŠ è½½åŸç†æ·±åº¦åˆ†æ

> **åŸºäºGDBè°ƒè¯•éªŒè¯ | OpenJDK 11 | HelloWorldç¤ºä¾‹**

---

## ğŸ“š æ–‡æ¡£ç›®å½•

| æ–‡æ¡£ | å†…å®¹ |
|------|------|
| [01_ç±»åŠ è½½å®Œæ•´æµç¨‹_GDBéªŒè¯](./01_ç±»åŠ è½½å®Œæ•´æµç¨‹_GDBéªŒè¯.md) | ç±»åŠ è½½ä¸‰é˜¶æ®µã€è°ƒç”¨æ ˆã€å­˜å‚¨ä½ç½® |
| [02_InstanceKlassä¸Methodæ•°æ®ç»“æ„](./02_InstanceKlassä¸Methodæ•°æ®ç»“æ„.md) | æ•°æ®ç»“æ„è¯¦è§£ã€å†…å­˜å¸ƒå±€ |
| [03_æ–¹æ³•è°ƒç”¨æœºåˆ¶_vtableä¸å­—èŠ‚ç æ‰§è¡Œ](./03_æ–¹æ³•è°ƒç”¨æœºåˆ¶_vtableä¸å­—èŠ‚ç æ‰§è¡Œ.md) | vtable/itableã€æ–¹æ³•åˆ†å‘ã€å­—èŠ‚ç æ‰§è¡Œ |

---

## ğŸ¯ æ ¸å¿ƒç»“è®ºé€Ÿè§ˆ

### 1. ç±»çš„æ•°æ®å­˜å‚¨ä½ç½®

```
                è™šæ‹Ÿåœ°å€ç©ºé—´
                
0x100000000 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             å‹ç¼©ç±»ç©ºé—´ (Compressed Class Space)
             â”‚
             â”‚  InstanceKlass   â† ç±»å…ƒæ•°æ®ä¸»ç»“æ„
             â”‚  vtable/itable   â† æ–¹æ³•åˆ†å‘è¡¨
             â”‚
0x140000000 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

0x7fff... â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             Non-class Metaspace
             â”‚
             â”‚  ConstantPool    â† å¸¸é‡æ± 
             â”‚  Method          â† æ–¹æ³•å…ƒæ•°æ®
             â”‚  ConstMethod     â† ä¸å˜æ–¹æ³•ä¿¡æ¯
             â”‚  å­—èŠ‚ç            â† æ–¹æ³•å­—èŠ‚ç 
             â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### 2. HelloWorldå…³é”®GDBæ•°æ®

| æ•°æ® | åœ°å€ | è¯´æ˜ |
|------|------|------|
| InstanceKlass | `0x100092840` | å‹ç¼©ç±»ç©ºé—´ |
| ConstantPool | `0x7fffd8c25068` | 29é¡¹ |
| Method (main) | `0x7fffd8c252e0` | 9å­—èŠ‚ç  |
| Method (init) | `0x7fffd8c25230` | 5å­—èŠ‚ç  |
| vtable | `0x100092a18` | 5ä¸ªæ¡ç›® |

### 3. ç±»åŠ è½½ä¸‰é˜¶æ®µ

```
åŠ è½½ (Loading)           é“¾æ¥ (Linking)              åˆå§‹åŒ– (Initialization)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚                       â”‚                           â”‚
â”‚ è¯»å–.classæ–‡ä»¶         â”‚ éªŒè¯å­—èŠ‚ç åˆæ³•æ€§           â”‚ æ‰§è¡Œ<clinit>
â”‚ åˆ›å»ºInstanceKlass      â”‚ å‡†å¤‡é™æ€å­—æ®µ               â”‚ å¡«å……vtable/itable
â”‚ åˆ†é…Metaspaceç©ºé—´       â”‚ è§£æç¬¦å·å¼•ç”¨(å¯å»¶è¿Ÿ)       â”‚ è®¾ç½®æ–¹æ³•å…¥å£
â”‚                       â”‚                           â”‚
_init_state: 1          _init_state: 2              _init_state: 4
(loaded)                (linked)                    (fully_initialized)
```

### 4. æ–¹æ³•è°ƒç”¨åˆ†å‘

| å­—èŠ‚ç  | æœºåˆ¶ | ç¤ºä¾‹ |
|--------|------|------|
| `invokevirtual` | vtableåˆ†å‘ | `obj.toString()` |
| `invokeinterface` | itableåˆ†å‘ | `list.add()` |
| `invokespecial` | é™æ€ç»‘å®š | `super.method()` |
| `invokestatic` | é™æ€ç»‘å®š | `Math.abs()` |

### 5. HelloWorld.mainå­—èŠ‚ç 

```
b2 00 02  getstatic #2      // System.out
12 03     ldc #3            // "Hello World"
b6 00 04  invokevirtual #4  // println
b1        return
```

---

## ğŸ”¬ GDBè°ƒè¯•å‘½ä»¤å¿«é€Ÿå‚è€ƒ

```bash
# æ–­ç‚¹è®¾ç½®
break InstanceKlass::link_class_impl
break InstanceKlass::initialize_impl
break SystemDictionary::load_instance_class

# æŸ¥çœ‹InstanceKlass
print *this
print this->_vtable_len
print this->_methods->_length

# æŸ¥çœ‹Method
set $m = ((Method**)(this->_methods->_data))[1]
print $m->_access_flags
print $m->_vtable_index

# æŸ¥çœ‹å­—èŠ‚ç 
set $cm = $m->_constMethod
x/9xb (char*)$cm + sizeof(ConstMethod)

# æŸ¥çœ‹vtable
set $vtable = (Method**)((char*)this + sizeof(InstanceKlass))
print $vtable[0]
call $vtable[0]->name()->print()
```

---

## ğŸ“Š å…³é”®æ•°æ®ç»“æ„å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      InstanceKlass                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ _name: "HelloWorld"                                       â”‚  â”‚
â”‚  â”‚ _super: java/lang/Object                                  â”‚  â”‚
â”‚  â”‚ _constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ConstantPool (29é¡¹)       â”‚  â”‚
â”‚  â”‚ _methods â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Array<Method*> (2ä¸ª)      â”‚  â”‚
â”‚  â”‚                                      â”‚                    â”‚  â”‚
â”‚  â”‚ _vtable_len: 5                       â”œâ”€â”€â–º Method[0]: init â”‚  â”‚
â”‚  â”‚ _itable_len: 2                       â”‚       â”‚            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚       â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ vtable[0]: finalize â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â–¼            â”‚  â”‚
â”‚  â”‚ vtable[1]: equals                    â”‚    ConstMethod     â”‚  â”‚
â”‚  â”‚ vtable[2]: toString                  â”‚       â”‚            â”‚  â”‚
â”‚  â”‚ vtable[3]: hashCode                  â”‚       â–¼            â”‚  â”‚
â”‚  â”‚ vtable[4]: clone                     â”‚    å­—èŠ‚ç  (5 bytes) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚                       â”‚
â”‚                                         â””â”€â”€â–º Method[1]: main    â”‚
â”‚                                                  â”‚               â”‚
â”‚                                                  â–¼               â”‚
â”‚                                              ConstMethod         â”‚
â”‚                                                  â”‚               â”‚
â”‚                                                  â–¼               â”‚
â”‚                                              å­—èŠ‚ç  (9 bytes)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸƒ å¿«é€Ÿé˜…è¯»è·¯å¾„

**5åˆ†é’Ÿé€Ÿè§ˆ**:
1. çœ‹æœ¬æ–‡æ¡£çš„"æ ¸å¿ƒç»“è®ºé€Ÿè§ˆ"
2. äº†è§£ç±»æ•°æ®å­˜å‚¨ä½ç½®

**30åˆ†é’Ÿæ·±å…¥**:
1. é˜…è¯» [01_ç±»åŠ è½½å®Œæ•´æµç¨‹](./01_ç±»åŠ è½½å®Œæ•´æµç¨‹_GDBéªŒè¯.md) ç¬¬ä¸€~ä¸‰èŠ‚
2. é˜…è¯» [02_æ•°æ®ç»“æ„](./02_InstanceKlassä¸Methodæ•°æ®ç»“æ„.md) ç¬¬å››~äº”èŠ‚
3. é˜…è¯» [03_æ–¹æ³•è°ƒç”¨](./03_æ–¹æ³•è°ƒç”¨æœºåˆ¶_vtableä¸å­—èŠ‚ç æ‰§è¡Œ.md) ç¬¬äºŒ~ä¸‰èŠ‚

**2å°æ—¶ç²¾è¯»**:
- å®Œæ•´é˜…è¯»ä¸‰ç¯‡æ–‡æ¡£
- å¯¹ç…§GDBæ•°æ®ç†è§£æ¯ä¸ªå­—æ®µ

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2026-01-15*
*éªŒè¯ç¯å¢ƒ: OpenJDK 11.0.17 slowdebug, GDB, Linux x86_64*
