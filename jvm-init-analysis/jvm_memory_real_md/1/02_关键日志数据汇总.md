# JVM内存布局关键日志数据汇总

> 测试命令: `java -Xms8g -Xmx8g -XX:+UseG1GC -XX:-UseLargePages HelloWorld`

---

## 一、NMT (Native Memory Tracking) 完整输出

```
Native Memory Tracking:

Total: reserved=10,361,919,469, committed=9,019,860,973

-                 Java Heap (reserved=8,589,934,592, committed=8,589,934,592)
                            (mmap: reserved=8,589,934,592, committed=8,589,934,592)

-                     Class (reserved=1,082,380,619, committed=7,197,003)
                            (classes #911)
                            (  instance classes #814, array classes #97)
                            (  mmap: reserved=1,082,130,432, committed=6,946,816)
                            (    reserved=8,388,608, committed=6,291,456)
                            (  Class space:)
                            (    reserved=1,073,741,824, committed=655,360)
                            (    used=572,008)

-                    Thread (reserved=23,177,120, committed=1,144,736)
                            (thread #22)
                            (stack: reserved=23,068,672, committed=1,036,288)

-                      Code (reserved=254,929,197, committed=10,086,701)
                            (malloc=1,300,781 #36926)
                            (mmap: reserved=253,628,416, committed=8,785,920)

-                        GC (reserved=392,629,159, committed=392,629,159)
                            (malloc=39,500,711 #14827)
                            (mmap: reserved=353,128,448, committed=353,128,448)

-                  Compiler (reserved=4,018,578, committed=4,018,578)
                            (malloc=12,642 #127)
                            (arena=4,005,936 #19)

-                  Internal (reserved=604,601, committed=604,601)
                            (malloc=571,833 #1141)
                            (mmap: reserved=32,768, committed=32,768)

-                    Symbol (reserved=2,626,360, committed=2,626,360)
                            (malloc=1,701,344 #2138)
                            (arena=925,016 #1)

-    Native Memory Tracking (reserved=1,263,072, committed=1,263,072)
                            (malloc=271,888 #2603)
                            (tracking overhead=991,184)

-               Arena Chunk (reserved=10,198,544, committed=10,198,544)
                            (malloc=10,198,544)

-                   Tracing (reserved=120, committed=120)
                            (malloc=120 #5)

-                   Logging (reserved=6,276, committed=6,276)
                            (malloc=6,276 #198)

-                 Arguments (reserved=20,639, committed=20,639)
                            (malloc=20,639 #518)

-                    Module (reserved=77,344, committed=77,344)
                            (malloc=77,344 #1044)

-              Synchronizer (reserved=45,056, committed=45,056)
                            (malloc=45,056 #298)

-                 Safepoint (reserved=8,192, committed=8,192)
                            (mmap: reserved=8,192, committed=8,192)
```

---

## 二、GC/Heap 关键日志

### 2.1 堆初始化

```
[gc      ] MarkStackSize: 4096k  MarkStackSizeMax: 16384k
[gc,heap ] Heap region size: 4M
[gc,heap ] Minimum heap 8589934592  Initial heap 8589934592  Maximum heap 8589934592
[gc,workgang] Constructing work gang GC Thread with 13 threads
[gc,heap,coops] Trying to allocate at address 0x0000000600000000 heap of size 0x200000000
```

### 2.2 G1CardTable

```
[gc,barrier] G1CardTable::G1CardTable:
[gc,barrier]     &_byte_map[0]: 0x00007f10e4000000
[gc,barrier]     &_byte_map[_last_valid_index]: 0x00007f10e4ffffff
[gc,barrier]     _byte_map_base: 0x00007f10e1000000
```

### 2.3 G1BlockOffsetTable

```
[gc,bot] G1BlockOffsetTable::G1BlockOffsetTable:
[gc,bot]     rs.base(): 0x00007f10f8bf1000
[gc,bot]     rs.size(): 16777216
[gc,bot]     rs end(): 0x00007f10f9bf1000
```

### 2.4 并发线程

```
[gc] ConcGCThreads: 3 offset 29
[gc] ParallelGCThreads: 13
[gc,workgang] Constructing work gang G1 Conc with 3 threads
[gc] Initialize mark stack with 4096 chunks, maximum 16384
```

### 2.5 堆扩展和压缩指针

```
[gc,ergo,heap] Expand the heap. requested expansion amount: 8589934592B expansion amount: 8589934592B
[gc,heap,coops] Heap address: 0x0000000600000000, size: 8192 MB, 
                Compressed Oops mode: Zero based, Oop shift amount: 3
```

### 2.6 Region分配 (前10个)

```
[gc,region] G1HR COMMIT(FREE) [0x0000000600000000, 0x0000000600000000, 0x0000000600400000]
[gc,region] G1HR COMMIT(FREE) [0x0000000600400000, 0x0000000600400000, 0x0000000600800000]
[gc,region] G1HR COMMIT(FREE) [0x0000000600800000, 0x0000000600800000, 0x0000000600c00000]
[gc,region] G1HR COMMIT(FREE) [0x0000000600c00000, 0x0000000600c00000, 0x0000000601000000]
[gc,region] G1HR COMMIT(FREE) [0x0000000601000000, 0x0000000601000000, 0x0000000601400000]
[gc,region] G1HR COMMIT(FREE) [0x0000000601400000, 0x0000000601400000, 0x0000000601800000]
[gc,region] G1HR COMMIT(FREE) [0x0000000601800000, 0x0000000601800000, 0x0000000601c00000]
[gc,region] G1HR COMMIT(FREE) [0x0000000601c00000, 0x0000000601c00000, 0x0000000602000000]
[gc,region] G1HR COMMIT(FREE) [0x0000000602000000, 0x0000000602000000, 0x0000000602400000]
[gc,region] G1HR COMMIT(FREE) [0x0000000602400000, 0x0000000602400000, 0x0000000602800000]
...
(共2048个Region)
```

---

## 三、Metaspace 关键日志

### 3.1 Compressed Class Space

```
[gc,metaspace] node @0x00007f0240ccb5c0: reserved=1048576.00 KB, committed=0.00 KB (0%), used=0.00 KB (0%)
[gc,metaspace]    [0x0000000800000000, 0x0000000800000000, 0x0000000800000000, 0x0000000840000000)
[gc,metaspace] Narrow klass base: 0x0000000800000000, Narrow klass shift: 0
[gc,metaspace] Compressed class space size: 1073741824 Address: 0x0000000800000000 Req Addr: 0x0000000800000000
```

### 3.2 Non-class Metaspace

```
[gc,metaspace] node @0x00007f0240ccb7f0: reserved=8192.00 KB, committed=0.00 KB (0%), used=0.00 KB (0%)
[gc,metaspace]    [0x00007f020b800000, 0x00007f020b800000, 0x00007f020b800000, 0x00007f020c000000)
```

### 3.3 Metachunk分配

```
[gc,metaspace,freelist] SpaceManager::added chunk:
[gc,metaspace,freelist] Metachunk: bottom 0x00007f020b800000 top 0x00007f020b800040 
                        end 0x00007f020bc00000 size 524288 (humongous)

[gc,metaspace,freelist] SpaceManager::added chunk:
[gc,metaspace,freelist] Metachunk: bottom 0x0000000800000000 top 0x0000000800000040 
                        end 0x0000000800060000 size 49152 (humongous)
```

---

## 四、CodeCache 日志

```
CodeHeap 'non-profiled nmethods': size=119172Kb used=1Kb max_used=1Kb free=119170Kb
CodeHeap 'profiled nmethods':     size=119168Kb used=1Kb max_used=1Kb free=119166Kb
CodeHeap 'non-nmethods':          size=7420Kb  used=1615Kb max_used=1626Kb free=5805Kb
```

---

## 五、OS/Thread 关键日志

### 5.1 系统信息

```
[os] Use of CLOCK_MONOTONIC is supported
[os] Use of pthread_condattr_setclock is supported
[os] HotSpot is running with glibc 2.38, NPTL 2.38
[os] SafePoint Polling address, bad (protected) page:0x00007f10fd7f8000, good page:0x00007f10fd7f9000
[os,cpu] CPU:total 16 (initial active 16) (16 cores per cpu, 2 threads per core)
[os,cpu] family 23 model 49 stepping 0 microcode 0x1000065
[os,cpu] model name: AMD EPYC 7K62 48-Core Processor
[os] total system memory: 33382146048 (~31GB)
```

### 5.2 线程启动

```
[os,thread] Thread "GC Thread#0" started (stacksize: 1024k, guardsize: 4k, detached)
[os,thread] Thread is alive (tid: 1304434, pthread id: 139710900991680)
[os,thread] Thread 1304434 stack dimensions: 0x00007f10fa900000-0x00007f10faa00000 (1024k)

[os,thread] Thread "G1 Main Marker" started (stacksize: 1024k, guardsize: 4k, detached)
[os,thread] Thread is alive (tid: 1304435, pthread id: 139710869472960)
[os,thread] Thread 1304435 stack dimensions: 0x00007f10f8af1000-0x00007f10f8bf1000 (1024k)

[os,thread] Thread "G1 Conc#0" started (stacksize: 1024k, guardsize: 4k, detached)
[os,thread] Thread is alive (tid: 1304436, pthread id: 139710868416192)
[os,thread] Thread 1304436 stack dimensions: 0x00007f10f89ef000-0x00007f10f8aef000 (1024k)

[os,thread] Thread "G1 Refine#0" started (stacksize: 1024k, guardsize: 4k, detached)
[os,thread] Thread is alive (tid: 1304437, pthread id: 139710131320512)

[os,thread] Thread "G1 Young RemSet Sampling" started (stacksize: 1024k, guardsize: 4k, detached)
[os,thread] Thread is alive (tid: 1304438, pthread id: 139710130263744)

[os,thread] Thread "VM Thread" started (stacksize: 1024k, guardsize: 4k, detached)
[os,thread] Thread is alive (tid: 1304439, pthread id: 139710120289984)
```

---

## 六、Heap Exit (程序退出时的堆状态)

```
[gc,heap,exit] Heap
[gc,heap,exit]  garbage-first heap   total 8388608K, used 12288K [0x0000000600000000, 0x0000000800000000)
[gc,heap,exit]   region size 4096K, 4 young (16384K), 0 survivors (0K)
[gc,heap,exit]  Metaspace       used 6488K, capacity 6642K, committed 6784K, reserved 1056768K
[gc,heap,exit]   class space    used 558K, capacity 620K, committed 640K, reserved 1048576K
```

### ClassLoaderData列表 (部分)

```
[gc,heap,exit] ClassLoaderData CLD: 0x00007f10f4c94110, loader: 0x0000000000000000, loader_klass: 'bootstrap' 
               { metaspace: 0x00007f10f4cbdc70 jni_method_id count = 10 handles count 1232 dependencies 5}

[gc,heap,exit] ClassLoaderData CLD: 0x00007f10f4f73960, loader: 0x00007f10f4f73b18, loader_klass: 'platform' 
               { metaspace: 0x0000000000000000 handles count 25 dependencies 0}

[gc,heap,exit] ClassLoaderData CLD: 0x00007f10f4f6e350, loader: 0x00007f10f4f6e508, loader_klass: 'app' 
               { metaspace: 0x00007f10f4fdce20 jni_method_id count = 1 handles count 21 dependencies 0}
```

---

## 七、NMT详细地址映射

```
[0x0000000600000000 - 0x0000000800000000] reserved and committed 8589934592 for Java Heap from
    ReservedHeapSpace::try_reserve_heap()
    
[0x0000000800000000 - 0x0000000840000000] reserved 1073741824 for Class from
    ReservedSpace::initialize()
    
[0x00007fc841700000 - 0x00007fc841800000] reserved 1048576 for Thread Stack from
    Thread::register_thread_stack_with_NMT()
```

---

*日志收集时间: 2026-01-15*
*测试环境: OpenJDK 11.0.17-internal, Linux x86-64*
