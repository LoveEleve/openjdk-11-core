# 前言

## 为什么要写这本书？

当你在网上搜索"JVM原理"时，会看到无数的博客、视频、课程，它们大多停留在理论层面：告诉你"G1使用Region管理内存"、"有Remember Set避免全堆扫描"，但很少有人告诉你：

- **Remember Set到底长什么样？** 在源码中是哪个数据结构？
- **SATB是如何实现的？** 具体的写屏障代码在哪里？
- **Mixed GC的选择策略是什么？** 算法的具体实现在哪个文件？

**这本书就是要填补这个空白。**

## 本书的特点

### 1️⃣ 100%基于真实源码 + GDB调试验证

本书的每一个技术点都直接对应OpenJDK 11的源码，**更重要的是，我们用GDB实时调试验证了每一个关键流程**：

```cpp
// 不是伪代码，是真实的JVM源码
void G1CollectedHeap::do_collection_pause_at_safepoint(double target_pause_time_ms) {
  // 第12章会详细分析这个函数的每一行
}
```

```gdb
# 真实的GDB调试数据
Thread 2 "java" hit Breakpoint: universe_init() at universe.cpp:695
函数地址: 0x7ffff695f6e5
G1堆创建: 8GB, 512个Region, 每个16MB
```

**这是全网首个基于GDB调试验证的JVM源码分析！**

### 2️⃣ 聚焦G1垃圾收集器

G1是OpenJDK 11的默认GC，也是最复杂、最先进的生产级GC：
- ✅ **深度剖析G1源码**：从数据结构到算法实现
- ✅ **理论+实战结合**：不仅讲原理，还讲如何调优
- ✅ **对比其他GC**：Serial、Parallel、CMS的理论对比

### 3️⃣ 由浅入深的学习路径 + 调试驱动分析

```
第一部分：基础篇 → 理解对象、类、内存
  ⭐ 第1.5章：JVM初始化深度剖析（GDB调试验证）
第二部分：执行篇 → 理解代码如何运行
第三部分：GC篇   → 重点！G1源码全解析
第四部分：实战篇 → 性能调优与故障排查
```

**特别亮点**：第1.5章首次使用GDB调试验证了JVM的完整初始化过程，发现了多个纯源码分析无法获得的关键信息！

## 目标读者

本书适合：
- ✅ **有Java基础**（理解类、对象、引用）
- ✅ **想深入理解JVM**（不满足于理论知识）
- ✅ **需要性能调优**（遇到GC问题需要排查）
- ✅ **准备阅读源码**（需要一个向导）

不需要：
- ❌ 你不需要会C++（我会解释关键代码）
- ❌ 你不需要编译JVM（理解原理即可）
- ❌ 你不需要汇编基础（我会用图解说明）

## 实验环境

为了让实验结果可复现，本书统一使用：

```bash
操作系统: Linux (kernel 3.10+)
JVM版本:  OpenJDK 11
堆内存:   -Xms8g -Xmx8g (固定8GB)
GC:      G1 (默认)
大页:     关闭 (默认)
```

所有性能数据、GC日志都基于这个环境。

## 如何阅读本书？

### 🎯 快速通道（2周）
只读带⭐的章节，快速建立G1知识体系：
- ⭐ 第1.5章：JVM初始化深度剖析（调试验证，必读！）
- ⭐ 第2章：对象模型
- ⭐ 第8章：内存结构  
- ⭐ 第12章：G1收集器（核心！）
- ⭐ 第13章：写屏障与引用处理
- ⭐ 第22章：性能调优实战

### 📚 深度阅读（1-2个月）
按顺序阅读全部章节，建立完整的JVM知识图谱。

### 🔍 按需查阅
遇到具体问题时，直接跳到对应章节：
- Full GC频繁？ → 第12.7节
- 卡顿严重？ → 第12.8节  
- 内存泄漏？ → 第19章、第22.3节

## 源码导航

本书涉及的核心源码路径（基于OpenJDK 11）：

```
hotspot/src/share/
├── gc/
│   ├── g1/              ← 第12章核心！G1的所有实现
│   ├── shared/          ← 第9章：GC通用框架
│   └── ...
├── oops/                ← 第2章：对象模型
├── runtime/             ← 第7章：运行时系统
├── interpreter/         ← 第4章：解释器
├── compiler/            ← 第5章：编译器
├── memory/              ← 第8章：内存管理
└── services/            ← 第18章：监控服务
```

## 致谢

感谢OpenJDK社区数百位工程师的杰出工作，他们创造了这个工业级的虚拟机。

特别感谢：
- **G1的设计者们**：Tony Printezis、Charlie Gracie等
- **HotSpot的维护者们**：Oracle、Red Hat、SAP等公司的工程师

## 开始旅程

准备好了吗？让我们一起深入JVM的世界！

从下一章开始，我们将从JVM架构总览讲起，然后通过**GDB调试验证JVM初始化的每一个步骤**，最后深入G1的实现细节。

**记住**：源码不会骗人，**调试数据更不会骗人**，理解了真实的运行时行为，就理解了真相。

---

**让我们开始吧！** 👉 [第1章：JVM架构总览](./01-JVM架构总览.md)
