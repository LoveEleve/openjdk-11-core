<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="JVM Source Analysis" version="21.0.0" type="device">
  <diagram id="class-loading-metadata" name="类加载与元数据">
    <mxGraphModel dx="1600" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1800" pageHeight="1400" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- 标题 -->
        <mxCell id="title" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;&lt;b&gt;JVM类加载与元数据结构详解&lt;/b&gt;&lt;/font&gt;&lt;br&gt;源码: instanceKlass.hpp, method.hpp, constantPool.hpp, systemDictionary.hpp" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="700" height="50" as="geometry" />
        </mxCell>
        
        <!-- ==================== InstanceKlass 结构 ==================== -->
        <mxCell id="ik-title" value="&lt;b&gt;InstanceKlass (类元数据核心)&lt;/b&gt;&lt;br&gt;(instanceKlass.hpp)" style="text;html=1;strokeColor=none;fillColor=#f8cecc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="40" y="90" width="380" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="instanceklass" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="40" y="130" width="380" height="680" as="geometry" />
        </mxCell>
        
        <!-- 基本信息 -->
        <mxCell id="ik-section1" value="&lt;b&gt;【基本信息】&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=#dae8fc;align=center;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="140" width="360" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-name" value="&lt;b&gt;_name&lt;/b&gt; : Symbol*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 类名符号 (如 &quot;java/lang/String&quot;)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="165" width="360" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-super" value="&lt;b&gt;_super&lt;/b&gt; : Klass*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;父类指针 (Object的_super为NULL)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="210" width="175" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-java-mirror" value="&lt;b&gt;_java_mirror&lt;/b&gt; : OopHandle&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ Class对象引用&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="235" y="210" width="175" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-access" value="&lt;b&gt;_access_flags&lt;/b&gt; : AccessFlags&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;访问标志 (public/final/interface...)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="255" width="360" height="35" as="geometry" />
        </mxCell>
        
        <!-- 类加载状态 -->
        <mxCell id="ik-section2" value="&lt;b&gt;【类加载状态】&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=#dae8fc;align=center;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="295" width="360" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-init-state" value="&lt;b&gt;_init_state&lt;/b&gt; : u1&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 初始化状态&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#0066cc&quot;&gt;allocated→loaded→linked→being_initialized→fully_initialized&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="320" width="360" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-init-thread" value="&lt;b&gt;_init_thread&lt;/b&gt; : Thread*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;正在初始化此类的线程&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="375" width="175" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-classloader" value="&lt;b&gt;_class_loader_data&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;ClassLoaderData*&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="235" y="375" width="175" height="40" as="geometry" />
        </mxCell>
        
        <!-- 方法和字段 -->
        <mxCell id="ik-section3" value="&lt;b&gt;【方法和字段】&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=#dae8fc;align=center;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="420" width="360" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-methods" value="&lt;b&gt;_methods&lt;/b&gt; : Array&amp;lt;Method*&amp;gt;*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 方法数组&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;包含所有声明的方法&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="445" width="175" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-default-methods" value="&lt;b&gt;_default_methods&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;接口默认方法&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="235" y="445" width="175" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-fields" value="&lt;b&gt;_fields&lt;/b&gt; : Array&amp;lt;u2&amp;gt;*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 字段信息数组&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;每字段6个u2: access, name_index, sig_index, initval_index, low_offset, high_offset&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="500" width="360" height="50" as="geometry" />
        </mxCell>
        
        <!-- 常量池和vtable -->
        <mxCell id="ik-section4" value="&lt;b&gt;【常量池和虚表】&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=#dae8fc;align=center;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="555" width="360" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-constants" value="&lt;b&gt;_constants&lt;/b&gt; : ConstantPool*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 运行时常量池&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;字面量、符号引用、解析后的直接引用&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="580" width="360" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-vtable-len" value="&lt;b&gt;_vtable_len&lt;/b&gt; : int&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;虚方法表长度&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="635" width="115" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-itable-len" value="&lt;b&gt;_itable_len&lt;/b&gt; : int&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;接口表长度&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="175" y="635" width="115" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-nonstatic-field" value="&lt;b&gt;_nonstatic_field_size&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;实例字段大小&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="300" y="635" width="110" height="40" as="geometry" />
        </mxCell>
        
        <!-- 接口和内部类 -->
        <mxCell id="ik-section5" value="&lt;b&gt;【接口和内部类】&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=#dae8fc;align=center;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="680" width="360" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-interfaces" value="&lt;b&gt;_local_interfaces&lt;/b&gt; : Array&amp;lt;InstanceKlass*&amp;gt;*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;直接实现的接口&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="705" width="175" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-trans-interfaces" value="&lt;b&gt;_transitive_interfaces&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;所有接口(含继承)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="235" y="705" width="175" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-inner" value="&lt;b&gt;_inner_classes&lt;/b&gt; : Array&amp;lt;jushort&amp;gt;*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;内部类信息&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="750" width="175" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ik-nest" value="&lt;b&gt;_nest_members&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;嵌套成员(JDK 11)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="235" y="750" width="175" height="40" as="geometry" />
        </mxCell>
        
        <!-- ==================== Method 结构 ==================== -->
        <mxCell id="method-title" value="&lt;b&gt;Method (方法元数据)&lt;/b&gt;&lt;br&gt;(method.hpp)" style="text;html=1;strokeColor=none;fillColor=#d5e8d4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="450" y="90" width="320" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="method" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="450" y="130" width="320" height="480" as="geometry" />
        </mxCell>
        
        <!-- Method 基本信息 -->
        <mxCell id="m-constmethod" value="&lt;b&gt;_constMethod&lt;/b&gt; : ConstMethod*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 不变的方法数据&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;字节码、行号表、局部变量表&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="140" width="300" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="m-methoddata" value="&lt;b&gt;_method_data&lt;/b&gt; : MethodData*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 性能分析数据&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;分支跳转统计、类型Profile、调用计数&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="195" width="300" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="m-counters" value="&lt;b&gt;_method_counters&lt;/b&gt; : MethodCounters*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;调用计数器、回边计数器&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#0066cc&quot;&gt;触发JIT编译的关键&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="250" width="300" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="m-access" value="&lt;b&gt;_access_flags&lt;/b&gt; : AccessFlags&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;public/private/static/native/synchronized...&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="305" width="300" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="m-vtable-index" value="&lt;b&gt;_vtable_index&lt;/b&gt; : int&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;在vtable中的索引&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#0066cc&quot;&gt;-2=final, -1=非虚方法&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="350" width="145" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="m-itable-index" value="&lt;b&gt;_itable_index&lt;/b&gt; : int&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;在itable中的索引&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="615" y="350" width="145" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="m-intrinsic" value="&lt;b&gt;_intrinsic_id&lt;/b&gt; : u2&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;内置方法ID (如Math.sin)&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#0066cc&quot;&gt;JIT直接替换为优化代码&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="405" width="300" height="45" as="geometry" />
        </mxCell>
        
        <mxCell id="m-code" value="&lt;b&gt;_code&lt;/b&gt; : CompiledMethod*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ JIT编译后的代码&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;指向CodeCache中的nmethod&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="455" width="300" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="m-i2i" value="&lt;b&gt;_i2i_entry&lt;/b&gt; : address&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;解释器入口&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="510" width="145" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="m-from-interp" value="&lt;b&gt;_from_interpreted_entry&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;从解释器调用入口&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="615" y="510" width="145" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="m-from-compiled" value="&lt;b&gt;_from_compiled_entry&lt;/b&gt; : address&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;从编译代码调用入口&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="555" width="300" height="40" as="geometry" />
        </mxCell>
        
        <!-- ==================== ConstMethod 结构 ==================== -->
        <mxCell id="constmethod-title" value="&lt;b&gt;ConstMethod (不变方法数据)&lt;/b&gt;&lt;br&gt;(constMethod.hpp)" style="text;html=1;strokeColor=none;fillColor=#dae8fc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="450" y="620" width="320" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="constmethod" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="450" y="660" width="320" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="cm-constants" value="&lt;b&gt;_constants&lt;/b&gt; : ConstantPool*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;所属类的常量池&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="670" width="300" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cm-stackmap" value="&lt;b&gt;_stackmap_data&lt;/b&gt; : Array&amp;lt;u1&amp;gt;*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;栈映射表 (类型验证)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="710" width="300" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cm-max-stack" value="&lt;b&gt;_max_stack&lt;/b&gt; : u2&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;最大操作数栈&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="750" width="145" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cm-max-locals" value="&lt;b&gt;_max_locals&lt;/b&gt; : u2&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;最大局部变量&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="615" y="750" width="145" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cm-code-size" value="&lt;b&gt;_code_size&lt;/b&gt; : u2&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;字节码长度&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="790" width="145" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cm-name-index" value="&lt;b&gt;_name_index&lt;/b&gt; : u2&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;方法名索引&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="615" y="790" width="145" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cm-bytecode" value="&lt;b&gt;字节码数据&lt;/b&gt; (紧随其后)&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 实际的字节码指令&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="830" width="300" height="25" as="geometry" />
        </mxCell>
        
        <!-- ==================== ConstantPool 结构 ==================== -->
        <mxCell id="cp-title" value="&lt;b&gt;ConstantPool (运行时常量池)&lt;/b&gt;&lt;br&gt;(constantPool.hpp)" style="text;html=1;strokeColor=none;fillColor=#e1d5e7;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="800" y="90" width="300" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="constantpool" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="800" y="130" width="300" height="350" as="geometry" />
        </mxCell>
        
        <mxCell id="cp-tags" value="&lt;b&gt;_tags&lt;/b&gt; : Array&amp;lt;u1&amp;gt;*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 常量类型标签数组&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;JVM_CONSTANT_Utf8/Class/Methodref...&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="140" width="280" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="cp-cache" value="&lt;b&gt;_cache&lt;/b&gt; : ConstantPoolCache*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 常量池缓存&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;解析后的方法/字段引用&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="195" width="280" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="cp-pool-holder" value="&lt;b&gt;_pool_holder&lt;/b&gt; : InstanceKlass*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;所属的类&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="250" width="280" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cp-operands" value="&lt;b&gt;_operands&lt;/b&gt; : Array&amp;lt;u2&amp;gt;*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;invokedynamic操作数&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="290" width="280" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cp-resolved-refs" value="&lt;b&gt;_resolved_references&lt;/b&gt; : OopHandle&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;解析后的对象引用 (String, Class)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="330" width="280" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="cp-ref-map" value="&lt;b&gt;_reference_map&lt;/b&gt; : Array&amp;lt;u2&amp;gt;*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;引用映射表&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="375" width="280" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cp-length" value="&lt;b&gt;_length&lt;/b&gt; : int&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;常量池条目数&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="415" width="135" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cp-flags" value="&lt;b&gt;_flags&lt;/b&gt; : u2&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;标志位&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="955" y="415" width="135" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cp-data" value="&lt;b&gt;常量池数据&lt;/b&gt; (紧随其后)&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ intptr_t数组存储实际常量&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="455" width="280" height="25" as="geometry" />
        </mxCell>
        
        <!-- ==================== SystemDictionary 结构 ==================== -->
        <mxCell id="sd-title" value="&lt;b&gt;SystemDictionary (系统字典)&lt;/b&gt;&lt;br&gt;(systemDictionary.hpp)" style="text;html=1;strokeColor=none;fillColor=#f8cecc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="800" y="500" width="300" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="systemdict" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="800" y="540" width="300" height="220" as="geometry" />
        </mxCell>
        
        <mxCell id="sd-dictionary" value="&lt;b&gt;_dictionary&lt;/b&gt; : Dictionary*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 类字典 (哈希表)&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;key=(类名,类加载器), value=InstanceKlass*&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="550" width="280" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="sd-placeholder" value="&lt;b&gt;_placeholders&lt;/b&gt; : PlaceholderTable*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;占位符表 (正在加载的类)&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#0066cc&quot;&gt;防止重复加载&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="610" width="280" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="sd-loader-constraints" value="&lt;b&gt;_loader_constraints&lt;/b&gt; : LoaderConstraintTable*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;类加载约束表&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#0066cc&quot;&gt;确保类型一致性&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="665" width="280" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="sd-resolution-errors" value="&lt;b&gt;_resolution_errors&lt;/b&gt; : ResolutionErrorTable*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;解析错误记录&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="720" width="280" height="35" as="geometry" />
        </mxCell>
        
        <!-- ==================== ClassLoaderData 结构 ==================== -->
        <mxCell id="cld-title" value="&lt;b&gt;ClassLoaderData&lt;/b&gt;&lt;br&gt;(classLoaderData.hpp)" style="text;html=1;strokeColor=none;fillColor=#d5e8d4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1130" y="90" width="280" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="classloaderdata" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1130" y="130" width="280" height="300" as="geometry" />
        </mxCell>
        
        <mxCell id="cld-classloader" value="&lt;b&gt;_class_loader&lt;/b&gt; : OopHandle&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ ClassLoader对象引用&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;Bootstrap加载器为NULL&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="1140" y="140" width="260" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="cld-klasses" value="&lt;b&gt;_klasses&lt;/b&gt; : Klass*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 该加载器加载的类链表&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="1140" y="195" width="260" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="cld-packages" value="&lt;b&gt;_packages&lt;/b&gt; : PackageEntryTable*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;包信息表&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="1140" y="240" width="260" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cld-modules" value="&lt;b&gt;_modules&lt;/b&gt; : ModuleEntryTable*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;模块信息表 (JPMS)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="1140" y="280" width="260" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="cld-metaspace" value="&lt;b&gt;_metaspace&lt;/b&gt; : ClassLoaderMetaspace*&lt;br&gt;&lt;font color=&quot;#cc0000&quot;&gt;⭐ 该加载器的元空间&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;类卸载时一起回收&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="1140" y="320" width="260" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="cld-next" value="&lt;b&gt;_next&lt;/b&gt; : ClassLoaderData*&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;全局CLD链表&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="1140" y="375" width="125" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="cld-unloading" value="&lt;b&gt;_unloading&lt;/b&gt; : bool&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;是否正在卸载&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="1275" y="375" width="125" height="40" as="geometry" />
        </mxCell>
        
        <!-- ==================== 类加载流程 ==================== -->
        <mxCell id="flow-title" value="&lt;b&gt;类加载流程&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=#dae8fc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1130" y="450" width="280" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="flow1" value="&lt;b&gt;1. Loading&lt;/b&gt;&lt;br&gt;读取class文件&lt;br&gt;创建InstanceKlass" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="1130" y="485" width="130" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="flow2" value="&lt;b&gt;2. Linking&lt;/b&gt;&lt;br&gt;验证/准备/解析" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1275" y="485" width="130" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="flow3" value="&lt;b&gt;3. Initialization&lt;/b&gt;&lt;br&gt;执行&amp;lt;clinit&amp;gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1130" y="555" width="130" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="flow4" value="&lt;b&gt;4. Using&lt;/b&gt;&lt;br&gt;创建实例/调用" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="1275" y="555" width="130" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="flow-arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="flow1" target="flow2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow-arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="flow2" target="flow3">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1340" y="545" />
              <mxPoint x="1195" y="545" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="flow-arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="flow3" target="flow4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 双亲委派 -->
        <mxCell id="delegate-title" value="&lt;b&gt;双亲委派模型&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=#f8cecc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1130" y="630" width="280" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="delegate-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1130" y="660" width="280" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="del-boot" value="&lt;b&gt;Bootstrap&lt;/b&gt;&lt;br&gt;ClassLoader&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;(C++实现)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1210" y="670" width="100" height="45" as="geometry" />
        </mxCell>
        
        <mxCell id="del-ext" value="&lt;b&gt;Platform&lt;/b&gt;&lt;br&gt;ClassLoader" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1210" y="720" width="100" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="del-app" value="&lt;b&gt;Application&lt;/b&gt;&lt;br&gt;ClassLoader" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="1210" y="760" width="100" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="del-arrow1" value="委派" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;dashed=1;" edge="1" parent="1" source="del-app" target="del-ext">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="del-arrow2" value="委派" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;dashed=1;" edge="1" parent="1" source="del-ext" target="del-boot">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="del-note" value="&lt;font color=&quot;#666666&quot;&gt;先委派父加载器&lt;br&gt;父加载器无法加载&lt;br&gt;才自己加载&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1140" y="680" width="70" height="50" as="geometry" />
        </mxCell>
        
        <!-- 面试要点 -->
        <mxCell id="interview-note" value="&lt;b&gt;面试要点&lt;/b&gt;:&lt;br&gt;1. InstanceKlass是类在JVM中的运行时表示，存储在Metaspace&lt;br&gt;2. _java_mirror指向堆中的Class对象，Class.forName()返回的就是它&lt;br&gt;3. Method的_code字段指向JIT编译后的代码，初始为NULL&lt;br&gt;4. 常量池解析是懒加载的，首次使用时才解析符号引用&lt;br&gt;5. SystemDictionary是类查找的入口，key是(类名+类加载器)&lt;br&gt;6. ClassLoaderData管理类加载器的元空间，类卸载时整体回收" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;spacingLeft=10;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="800" y="780" width="400" height="120" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
